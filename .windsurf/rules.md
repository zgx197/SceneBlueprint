---
inclusion: always
---

# 项目协作规则

## 沟通与交流

### 语言要求
- 使用中文进行所有回复、思考、讨论等
- 优先使用中文显示思考过程
- 技术术语可保留英文原文，但需在首次出现时提供中文解释
- 代码注释优先使用中文，关键算法可中英文对照

### 讨论方式
- 讨论问题时需要追根溯源，深入分析问题的本质原因
- 结合具体代码片段或文字示例辅助理解
- 避免空泛的理论讨论，始终以实际代码为依据
- 对于复杂问题，先梳理问题的上下文和依赖关系

## 代码修改原则

### 修改前的准备
- **在解决方案未确定前不要修改代码**
- 先充分理解问题，再提出解决方案
- 对于不确定的修改，先与团队讨论确认
- 重要修改前需要备份或创建分支

### 代码审查要点
- 理解代码的设计意图和历史背景
- 识别潜在的副作用和影响范围
- 考虑代码的可维护性和可扩展性
- 检查是否符合项目现有的编码规范

## 解决方案设计

### 方案提出要求
- 在讨论解决方案时需要给出**若干个**备选方案
- 每个方案需要说明：
  - 实现思路和关键步骤
  - 优点和缺点
  - 适用场景和限制条件
  - 对现有代码的影响程度
  - 不需要给出详细的代码，可以给出简单的框架图或者流程图

### 方案评估标准
- **健壮性**：能否处理边界情况和异常情况
- **灵活性**：是否易于扩展和修改
- **适配性**：是否适合当前框架的设计理念
- **性能**：对系统性能的影响
- **可维护性**：代码的可读性和可维护性

## 优化与重构

### 优化前的分析
- 在思考优化方案时需要先查看**当前项目整体设计**
- 优先查看当前框架中是否存在不合理设计
- 识别设计模式和架构风格
- 了解现有的工具类、基础设施和公共组件

### 重构原则
- 遵循"先理解，再重构"的原则
- 小步快跑，避免大规模重写
- 保持向后兼容，或提供清晰的迁移路径
- 重构后需要验证功能完整性

### 代码复用
- 优先使用项目中已有的工具类和组件
- 避免重复造轮子
- 发现可复用代码时，考虑提取为公共组件
- 注意不同模块间的依赖关系
- 如果文件内容过多可以使用partial将逻辑分割开

## 问题分析方法

### 问题定位
1. 明确问题的表现形式和触发条件
2. 收集相关日志和错误信息
3. 定位问题代码的具体位置
4. 分析问题的根本原因（而非表面现象）

### 影响范围评估
- 识别受影响的模块和功能
- 检查是否有其他地方使用了相同的模式
- 评估修改可能带来的连锁反应
- 考虑对性能、内存、兼容性的影响

## 文档与注释

### 代码注释
- 复杂逻辑必须添加注释说明
- 注释应说明"为什么"而不仅是"是什么"
- 对于临时方案或已知问题，使用 TODO/FIXME 标记
- 重要的业务逻辑需要添加详细的文档注释

### 文档维护
- 代码修改后及时更新相关文档
- 新增功能需要编写使用说明
- 重要的设计决策需要记录在文档中
- 保持文档与代码的一致性

## 测试与验证

### 测试要求
- 修改代码后需要进行充分测试
- 测试应覆盖正常流程和异常情况
- 对于关键功能，需要编写单元测试
- 性能相关的修改需要进行性能测试

### 验证清单
- [ ] 功能是否符合预期
- [ ] 是否引入新的 bug
- [ ] 是否影响现有功能
- [ ] 性能是否满足要求
- [ ] 代码是否符合规范

## 协作与沟通

### 代码审查
- 重要修改需要经过代码审查
- 审查时关注设计合理性、代码质量、潜在问题
- 提出建设性的改进意见
- 尊重不同的实现思路

### 知识共享
- 遇到复杂问题时，记录解决过程
- 发现好的实践时，分享给团队
- 对于通用的解决方案，考虑沉淀为文档或工具
- 定期进行技术分享和经验交流

## 特殊注意事项

### Unity 项目特定规则
- 注意 Unity 生命周期和执行顺序
- 避免在主线程执行耗时操作
- 注意内存管理和对象池的使用
- 遵循 Unity 的最佳实践和性能优化建议

### C# 编码规范
- 遵循项目现有的命名规范
- 合理使用异步编程（async/await）
- 注意空引用检查和异常处理
- 优先使用 LINQ 和现代 C# 特性

## 持续改进

- 定期回顾和更新这些规则
- 根据项目实际情况调整规则
- 鼓励团队成员提出改进建议
- 将好的实践固化为规则


### 禁止事项
- 不要查看 Assets\Extensions\MapEditor 下的代码，这些是旧版本的代码