# SceneMarker ç³»ç»Ÿè®¾è®¡

> ç‰ˆæœ¬ï¼šv0.1ï¼ˆè‰æ¡ˆï¼‰  
> æ—¥æœŸï¼š2026-02-13  
> çŠ¶æ€ï¼šè®¾è®¡é˜¶æ®µ  
> å…³è”ï¼š[åœºæ™¯è“å›¾ç³»ç»Ÿæ€»ä½“è®¾è®¡](åœºæ™¯è“å›¾ç³»ç»Ÿæ€»ä½“è®¾è®¡.md) â€” Phase 4B-2 / Phase 5

---

## 1. æ¦‚è¿°

### 1.1 é—®é¢˜èƒŒæ™¯

å…³å¡è®¾è®¡å¸ˆçš„å·¥ä½œæµæ˜¯**ç©ºé—´å¯¼å‘**çš„ï¼šåœ¨ç™½æ¨¡åœ°å½¢ä¸Šè§„åˆ’æˆ˜æ–—åŒºåŸŸã€æ”¾ç½®åˆ·æ€ªç‚¹ã€å¸ƒç½®è§¦å‘å™¨å’Œæ¼”å‡ºäº‹ä»¶ã€‚è€Œè“å›¾ç¼–è¾‘å™¨æ˜¯**é€»è¾‘å¯¼å‘**çš„ï¼šèŠ‚ç‚¹å’Œè¿çº¿è¡¨è¾¾æ‰§è¡Œé¡ºåºå’Œæ¡ä»¶å…³ç³»ã€‚

å½“å‰çš„ SceneBinding æœºåˆ¶è¦æ±‚è®¾è®¡å¸ˆæ‰‹åŠ¨å°†åœºæ™¯å¯¹è±¡æ‹–å…¥è“å›¾èŠ‚ç‚¹çš„å±æ€§å­—æ®µï¼Œå¯¼è‡´ï¼š
- **ç©ºé—´ä¸Šä¸‹æ–‡æ–­è£‚**ï¼šè“å›¾ä¸­çœ‹ä¸åˆ°æ ‡è®°åœ¨åœºæ™¯ä¸­çš„ä½ç½®
- **é¢‘ç¹çª—å£åˆ‡æ¢**ï¼šScene View â†” è“å›¾ç¼–è¾‘å™¨ â†” Inspector
- **ç»‘å®šæ“ä½œç¢ç‰‡åŒ–**ï¼šæ¯ä¸ªç»‘å®šå­—æ®µéƒ½éœ€è¦æ‰‹åŠ¨æ‹–æ‹½

### 1.2 è®¾è®¡ç›®æ ‡

SceneMarker ç³»ç»Ÿæ—¨åœ¨æ¡¥æ¥ Scene View å’Œè“å›¾ç¼–è¾‘å™¨ï¼Œå®ç°ï¼š

1. **ç©ºé—´â†’é€»è¾‘ä¸€æ­¥åˆ°ä½**ï¼šåœ¨ Scene View ä¸­å³é”®åˆ›å»ºæ ‡è®°ï¼Œè‡ªåŠ¨ç”Ÿæˆè“å›¾èŠ‚ç‚¹å¹¶ç»‘å®š
2. **åˆ†å±‚å¯è§†åŒ–**ï¼šä¸åŒç±»å‹çš„æ ‡è®°æŒ‰å›¾å±‚ç®¡ç†ï¼Œå¯ç‹¬ç«‹åˆ‡æ¢å¯è§æ€§
3. **åŒå‘è”åŠ¨**ï¼šé€‰ä¸­è“å›¾èŠ‚ç‚¹ â†” åœºæ™¯é«˜äº®å¯¹åº”æ ‡è®°
4. **Tag ç³»ç»Ÿé›†æˆ**ï¼šæ ‡è®°è‡ªåŠ¨æºå¸¦ Tagï¼Œå›¾å±‚æ˜ å°„ç”± Tag å‰ç¼€é©±åŠ¨

---

## 2. æ ¸å¿ƒæ¦‚å¿µ

### 2.1 æ ‡è®°ä¸è“å›¾èŠ‚ç‚¹çš„å…³ç³»

```
å…³ç³»æ¨¡å‹ï¼šæ ‡è®°ç‹¬ç«‹å­˜åœ¨ï¼ŒèŠ‚ç‚¹æŒ‰éœ€å¼•ç”¨

  Scene View                          è“å›¾ç¼–è¾‘å™¨
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚AreaMarkerâ”‚â”€â”€â”€â”€ SceneBinding â”€â”€â”€â”€â–¶â”‚  Spawn   â”‚
  â”‚  (åŒºåŸŸ)  â”‚     (markerId)        â”‚  Action  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚          â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚          â”‚
  â”‚PointMarkerâ”‚â”€â”€â”€ SceneBinding â”€â”€â”€â”€â–¶â”‚          â”‚
  â”‚  (ç‚¹ä½1) â”‚     (markerId)        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚PointMarkerâ”‚â”€â”€â”€ SceneBinding â”€â”€â”€â”€â–¶ (åŒä¸€èŠ‚ç‚¹æˆ–ä¸åŒèŠ‚ç‚¹)
  â”‚  (ç‚¹ä½2) â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç‰¹æ€§ï¼š
  - ä¸€ä¸ªè“å›¾èŠ‚ç‚¹å¯ä»¥å¼•ç”¨å¤šä¸ªæ ‡è®°ï¼ˆå¦‚ Spawn å¼•ç”¨ 1 åŒºåŸŸ + N ç‚¹ä½ï¼‰
  - ä¸€ä¸ªæ ‡è®°å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹å¼•ç”¨ï¼ˆå¦‚åŒä¸€è§¦å‘åŒºåŸŸè§¦å‘æˆ˜æ–— + ç¯å…‰å˜åŒ–ï¼‰
  - æ ‡è®°åœ¨ Scene View ä¸­ç‹¬ç«‹äºè“å›¾å­˜åœ¨ï¼Œå¯ä»¥å…ˆæ”¾æ ‡è®°åç»‘å®š
```

### 2.2 æ ‡è®°ç±»å‹

| ç±»å‹ | ç©ºé—´å½¢æ€ | åœºæ™¯è¡¨è¾¾ | å…¸å‹ç”¨é€” |
|------|---------|---------|---------|
| **PointMarker** | å•ç‚¹ï¼ˆTransformï¼‰ | ä½ç½® + æœå‘ Gizmo | åˆ·æ€ªç‚¹ã€æ‘„åƒæœºä½ã€VFX æ’­æ”¾ç‚¹ã€è·¯å¾„ç‚¹ |
| **AreaMarker** | å¤šè¾¹å½¢ / Box åŒºåŸŸ | åŠé€æ˜åŒºåŸŸ + è¾¹æ¡† | è§¦å‘åŒºã€åˆ·æ€ªåŒºã€ç¯å…‰åŒºã€éŸ³é¢‘åŒº |
| **EntityMarker** | Prefab å®ä¾‹ | å®é™… Prefab é¢„è§ˆ | é¢„è®¾æ€ªç‰©ã€å¯äº¤äº’ç‰©ä½“ã€NPC |

### 2.3 å›¾å±‚ç³»ç»Ÿ

å›¾å±‚ç”± Tag å‰ç¼€è‡ªåŠ¨æ˜ å°„ï¼Œè®¾è®¡å¸ˆå¯æŒ‰éœ€åˆ‡æ¢å¯è§æ€§ï¼š

| å›¾å±‚ | Tag å‰ç¼€ | Gizmo é¢œè‰² | åŒ…å«å†…å®¹ |
|------|---------|-----------|---------|
| ğŸ”´ Combat | `Combat.*` | çº¢è‰² | åˆ·æ€ªç‚¹ã€åˆ·æ€ªåŒºã€ä¼å‡»ç‚¹ã€å·¡é€»è·¯å¾„ |
| ğŸ”µ Trigger | `Trigger.*` | è“è‰² | è§¦å‘åŒºåŸŸã€é˜»æŒ¡ä½“ã€è¿›åº¦é—¨ |
| ğŸŸ¡ Environment | `Environment.*` | é»„è‰² | ç¯å…‰åŒºåŸŸã€éŸ³é¢‘åŒºåŸŸã€é›¾æ•ˆåŒºåŸŸ |
| ğŸŸ¢ Camera | `Camera.*` | ç»¿è‰² | æ‘„åƒæœºä½ã€æ³¨è§†ç›®æ ‡ã€è¿é•œè·¯å¾„ |
| ğŸŸ£ Narrative | `Narrative.*` | ç´«è‰² | å¯¹è¯è§¦å‘ç‚¹ã€ç¬”è®°æ‹¾å–ç‚¹ |

---

## 3. ç»„ä»¶è®¾è®¡

### 3.1 SceneMarkerï¼ˆæŠ½è±¡åŸºç±»ï¼‰

```csharp
/// <summary>
/// åœºæ™¯æ ‡è®°åŸºç±» â€” è“å›¾èŠ‚ç‚¹ä¸åœºæ™¯ç©ºé—´çš„æ¡¥æ¢
/// </summary>
public abstract class SceneMarker : MonoBehaviour
{
    [ReadOnly] public string MarkerId;           // å”¯ä¸€ IDï¼ˆè“å›¾é€šè¿‡æ­¤ ID å¼•ç”¨ï¼‰
    public string MarkerName;                     // è®¾è®¡å¸ˆå¯è¯»åç§°
    public string Tag;                            // Tag æ ‡ç­¾ï¼ˆå¦‚ "Combat.SpawnPoint"ï¼‰
    [ReadOnly] public string SubGraphId;          // æ‰€å±å­è“å›¾ IDï¼ˆå¯ç©º=é¡¶å±‚ï¼‰

    /// <summary>æ ‡è®°ç±»å‹æšä¸¾ï¼ˆç”¨äºå›¾å±‚æ˜ å°„å’Œåºåˆ—åŒ–ï¼‰</summary>
    public abstract MarkerType Type { get; }

    /// <summary>è¿”å›æ ‡è®°çš„ä»£è¡¨ä½ç½®ï¼ˆç”¨äºåŒå‘è”åŠ¨èšç„¦ï¼‰</summary>
    public virtual Vector3 GetRepresentativePosition() => transform.position;
}
```

### 3.2 PointMarker

```csharp
/// <summary>å•ç‚¹æ ‡è®° â€” è¡¨ç¤ºä¸€ä¸ªä½ç½® + æœå‘</summary>
public class PointMarker : SceneMarker
{
    public override MarkerType Type => MarkerType.Point;
    public float GizmoRadius = 0.5f;             // Gizmo æ˜¾ç¤ºåŠå¾„

    // Transform æœ¬èº«å³ä¸ºç©ºé—´æ•°æ®ï¼Œæ— éœ€é¢å¤–å­—æ®µ
}
```

### 3.3 AreaMarker

```csharp
/// <summary>åŒºåŸŸæ ‡è®° â€” è¡¨ç¤ºä¸€ä¸ªå¤šè¾¹å½¢æˆ– Box åŒºåŸŸ</summary>
public class AreaMarker : SceneMarker
{
    public override MarkerType Type => MarkerType.Area;

    public AreaShape Shape = AreaShape.Polygon;   // Polygon / Box
    public List<Vector3> Vertices = new();        // å¤šè¾¹å½¢é¡¶ç‚¹ï¼ˆç›¸å¯¹åæ ‡ï¼‰
    public Vector3 BoxSize = Vector3.one;         // Box æ¨¡å¼çš„å°ºå¯¸
    public float Height = 3f;                     // åŒºåŸŸé«˜åº¦ï¼ˆç”¨äºä½“ç§¯åˆ¤å®šï¼‰

    /// <summary>è¿”å›åŒºåŸŸä¸­å¿ƒ</summary>
    public override Vector3 GetRepresentativePosition()
    {
        if (Shape == AreaShape.Box) return transform.position;
        if (Vertices.Count == 0) return transform.position;
        var center = Vector3.zero;
        foreach (var v in Vertices) center += v;
        return transform.position + center / Vertices.Count;
    }
}

public enum AreaShape { Polygon, Box }
```

### 3.4 EntityMarker

```csharp
/// <summary>å®ä½“æ ‡è®° â€” è¡¨ç¤ºä¸€ä¸ª Prefab å®ä¾‹çš„æ”¾ç½®</summary>
public class EntityMarker : SceneMarker
{
    public override MarkerType Type => MarkerType.Entity;

    public GameObject PrefabRef;                  // å¼•ç”¨çš„ Prefab
    public int Count = 1;                         // æ•°é‡ï¼ˆç”¨äºåˆ·æ€ªç­‰åœºæ™¯ï¼‰
    // Prefab çš„é¢„è§ˆé€šè¿‡ Editor ä¾§ PreviewRenderer å®ç°
}
```

### 3.5 MarkerRequirementï¼ˆAction åœºæ™¯éœ€æ±‚å£°æ˜ï¼‰

```csharp
/// <summary>
/// Action å£°æ˜å®ƒéœ€è¦ä»€ä¹ˆç±»å‹çš„åœºæ™¯æ ‡è®°ã€‚
/// æ”¾åœ¨ ActionDefinition ä¸­ï¼Œé©±åŠ¨ï¼š
///   - Scene View å³é”®èœå•è‡ªåŠ¨åˆ›å»ºå¯¹åº”æ ‡è®°
///   - Inspector è‡ªåŠ¨ç”Ÿæˆç»‘å®š UI
///   - éªŒè¯é€»è¾‘æ£€æŸ¥å¿…éœ€æ ‡è®°æ˜¯å¦å·²ç»‘å®š
/// </summary>
[Serializable]
public class MarkerRequirement
{
    public string BindingKey;          // ç»‘å®šé”®åï¼ˆå¦‚ "spawnArea", "spawnPoints"ï¼‰
    public MarkerType MarkerType;      // éœ€è¦çš„æ ‡è®°ç±»å‹
    public string DisplayName;         // æ˜¾ç¤ºåç§°ï¼ˆå¦‚ "åˆ·æ€ªåŒºåŸŸ"ï¼‰
    public bool Required;              // æ˜¯å¦å¿…éœ€
    public bool AllowMultiple;         // æ˜¯å¦å…è®¸ç»‘å®šå¤šä¸ªæ ‡è®°
    public int MinCount;               // æœ€å°‘æ•°é‡ï¼ˆAllowMultiple æ—¶æœ‰æ•ˆï¼‰
    public string DefaultTag;          // è‡ªåŠ¨åˆ›å»ºæ—¶çš„é»˜è®¤ Tag
}
```

---

## 4. Scene View äº¤äº’è®¾è®¡

### 4.1 å³é”®åˆ›å»ºèœå•

èœå•æŒ‰è®¾è®¡å¸ˆæ„å›¾ç»„ç»‡ï¼ˆè€ŒéæŠ€æœ¯æ ‡è®°ç±»å‹ï¼‰ï¼Œç”±å·²æ³¨å†Œçš„ ActionDefinition è‡ªåŠ¨ç”Ÿæˆï¼š

```
åœ¨æ­¤ä½ç½®åˆ›å»ºè¡ŒåŠ¨...
â”œâ”€â”€ âš”ï¸ æˆ˜æ–—
â”‚   â”œâ”€â”€ åˆ·æ€ªï¼ˆåŒºåŸŸ + ç‚¹ä½ï¼‰         â† SpawnDef.SceneRequirements é©±åŠ¨
â”‚   â”œâ”€â”€ æ”¾ç½®é¢„è®¾æ€ª                  â† PlacePresetDefï¼ˆEntityMarkerï¼‰
â”‚   â””â”€â”€ ä¼å‡»ç‚¹                      â† AmbushDefï¼ˆPointMarkerï¼‰
â”œâ”€â”€ ğŸ¯ è§¦å‘
â”‚   â”œâ”€â”€ è¿›å…¥è§¦å‘åŒº                  â† TriggerZoneDefï¼ˆAreaMarkerï¼‰
â”‚   â””â”€â”€ äº¤äº’è§¦å‘                    â† InteractDefï¼ˆPointMarkerï¼‰
â”œâ”€â”€ ğŸ¬ æ¼”å‡º
â”‚   â”œâ”€â”€ æ‘„åƒæœºè¡Œä¸º                  â† CameraActionDefï¼ˆPointMarker Ã— 2ï¼‰
â”‚   â””â”€â”€ æ’­æ”¾ç‰¹æ•ˆ                    â† PlayVFXDefï¼ˆPointMarkerï¼‰
â”œâ”€â”€ ğŸ’¡ ç¯å¢ƒ
â”‚   â”œâ”€â”€ ç¯å…‰å˜åŒ–                    â† LightingDefï¼ˆAreaMarkerï¼‰
â”‚   â””â”€â”€ éŸ³é¢‘åŒºåŸŸ                    â† AudioZoneDefï¼ˆAreaMarkerï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â””â”€â”€ ğŸ·ï¸ ä»…åˆ›å»ºæ ‡è®°ï¼ˆä¸åˆ›å»ºè“å›¾èŠ‚ç‚¹ï¼‰
    â”œâ”€â”€ ç‚¹ä½æ ‡è®°
    â”œâ”€â”€ åŒºåŸŸæ ‡è®°
    â””â”€â”€ å®ä½“æ ‡è®°
```

èœå•é¡¹æ¥æºï¼š
- éå† `ActionRegistry` ä¸­æ‰€æœ‰å®šä¹‰äº† `SceneRequirements` çš„ Action
- æŒ‰ Action çš„ `Category` å­—æ®µåˆ†ç»„ï¼ˆæˆ˜æ–— / è§¦å‘ / æ¼”å‡º / ç¯å¢ƒï¼‰
- æ²¡æœ‰ `SceneRequirements` çš„ Actionï¼ˆå¦‚ Delayã€Branchï¼‰ä¸å‡ºç°åœ¨èœå•ä¸­

### 4.2 å¤šæ­¥åˆ›å»ºæµç¨‹

å¯¹äºéœ€è¦å¤šä¸ªæ ‡è®°çš„ Actionï¼ˆå¦‚ Spawn = åŒºåŸŸ + å¤šä¸ªç‚¹ä½ï¼‰ï¼š

```
æ­¥éª¤ 1ï¼šé€‰æ‹©èœå•é¡¹"åˆ·æ€ª"
  â†’ è¿›å…¥åŒºåŸŸç»˜åˆ¶æ¨¡å¼ï¼ˆé¼ æ ‡å˜åå­—å‡†æ˜Ÿï¼‰
  â†’ å·¥å…·æ æç¤ºï¼š"ç‚¹å‡»æ”¾ç½®åŒºåŸŸé¡¶ç‚¹ï¼ŒåŒå‡»ç»“æŸç»˜åˆ¶"
  â†’ ç»˜åˆ¶å®Œæˆ â†’ AreaMarker åˆ›å»º

æ­¥éª¤ 2ï¼šè‡ªåŠ¨è¿›å…¥ç‚¹ä½æ”¾ç½®æ¨¡å¼
  â†’ å·¥å…·æ æç¤ºï¼š"ç‚¹å‡»æ”¾ç½®åˆ·æ€ªç‚¹ï¼ˆå·²æ”¾ç½® 0 ä¸ªï¼‰ï¼ŒEsc ç»“æŸ"
  â†’ æ¯æ¬¡ç‚¹å‡»åˆ›å»ºä¸€ä¸ª PointMarker
  â†’ ç‚¹ä½è‡ªåŠ¨é™åˆ¶åœ¨åŒºåŸŸèŒƒå›´å†…ï¼ˆå¯é€‰ï¼‰
  â†’ æŒ‰ Esc æˆ–å³é”®ç»“æŸ

æ­¥éª¤ 3ï¼šè‡ªåŠ¨å®Œæˆ
  â†’ è“å›¾ç¼–è¾‘å™¨ä¸­åˆ›å»º Spawn èŠ‚ç‚¹
  â†’ è‡ªåŠ¨ç»‘å®š AreaMarker + æ‰€æœ‰ PointMarker
  â†’ èŠ‚ç‚¹è‡ªåŠ¨åŠ å…¥å½“å‰å±•å¼€çš„å­è“å›¾ï¼ˆå¦‚æœ‰ï¼‰
  â†’ Inspector æ˜¾ç¤ºæ–°èŠ‚ç‚¹å±æ€§
```

åˆ›å»ºé¡ºåºç”± `SceneRequirements` ä¸­çš„å®šä¹‰é¡ºåºå†³å®šï¼ŒRequired å­—æ®µæ§åˆ¶å“ªäº›æ­¥éª¤ä¸å¯è·³è¿‡ã€‚

### 4.3 Gizmo ç»˜åˆ¶è§„åˆ™

```
PointMarkerï¼š
  - å®å¿ƒåœ†çƒ + æ–¹å‘ç®­å¤´
  - å¤§å°æ ¹æ®æ‘„åƒæœºè·ç¦»è‡ªé€‚åº”
  - é¢œè‰²ç”±å›¾å±‚å†³å®šï¼ˆTag å‰ç¼€æ˜ å°„ï¼‰

AreaMarkerï¼ˆPolygonï¼‰ï¼š
  - åŠé€æ˜å¡«å…… + å®çº¿è¾¹æ¡†
  - é¡¶ç‚¹æ˜¾ç¤ºä¸ºå¯æ‹–æ‹½å°æ–¹å—ï¼ˆç¼–è¾‘æ¨¡å¼ä¸‹ï¼‰
  - é«˜åº¦èŒƒå›´ç”¨è™šçº¿ç«–çº¿è¡¨ç¤º

AreaMarkerï¼ˆBoxï¼‰ï¼š
  - åŠé€æ˜ Cube + çº¿æ¡†
  - å¯é€šè¿‡ Handle è°ƒæ•´å°ºå¯¸

EntityMarkerï¼š
  - Prefab çš„çº¿æ¡†é¢„è§ˆï¼ˆå¦‚æœæœ‰ MeshFilterï¼‰
  - å¦åˆ™æ˜¾ç¤ºä¸ºè±å½¢å›¾æ ‡ + Prefab åç§°æ ‡ç­¾

æ‰€æœ‰æ ‡è®°ï¼š
  - æ˜¾ç¤º MarkerName æ–‡æœ¬æ ‡ç­¾ï¼ˆå¯åœ¨è®¾ç½®ä¸­å…³é—­ï¼‰
  - è¢«è“å›¾èŠ‚ç‚¹å¼•ç”¨æ—¶æ ‡ç­¾æ—æ˜¾ç¤º ğŸ”— å›¾æ ‡
  - é€‰ä¸­è“å›¾èŠ‚ç‚¹æ—¶ï¼Œå…³è”æ ‡è®° Gizmo åŠ ç²— + è„‰å†²åŠ¨ç”»
```

### 4.4 å›¾å±‚å¯è§æ€§æ§åˆ¶

```
å®ç°æ–¹å¼ï¼šScene View Overlay å·¥å…·æ ï¼ˆUnity 2021.2+ SceneView.AddOverlayToActiveViewï¼‰

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ·ï¸ æ ‡è®°å›¾å±‚                      â”‚
â”‚  â˜‘ ğŸ”´ æˆ˜æ–—  â˜‘ ğŸ”µ è§¦å‘           â”‚
â”‚  â˜‘ ğŸŸ¡ ç¯å¢ƒ  â˜ ğŸŸ¢ æ‘„åƒæœº         â”‚  â† æ‘„åƒæœºå›¾å±‚å·²éšè—
â”‚  â˜‘ ğŸŸ£ å™äº‹                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  [å…¨éƒ¨æ˜¾ç¤º] [å…¨éƒ¨éšè—]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¿‡æ»¤é€»è¾‘ï¼š
  - æ ¹æ® SceneMarker.Tag çš„ç¬¬ä¸€çº§å‰ç¼€åŒ¹é…å›¾å±‚
  - å›¾å±‚å…³é—­æ—¶ï¼Œè¯¥å›¾å±‚æ‰€æœ‰æ ‡è®°çš„ Gizmo ä¸ç»˜åˆ¶
  - ä¸å½±å“æ ‡è®° GameObject çš„ activeInHierarchyï¼ˆåªæ˜¯è§†è§‰éšè—ï¼‰
```

---

## 5. åŒå‘è”åŠ¨

### 5.1 è“å›¾ â†’ åœºæ™¯

| æ“ä½œ | åœºæ™¯å“åº” |
|------|---------|
| é€‰ä¸­è“å›¾èŠ‚ç‚¹ | Scene View é«˜äº®è¯¥èŠ‚ç‚¹ç»‘å®šçš„æ‰€æœ‰æ ‡è®°ï¼ˆGizmo åŠ ç²— + é¢œè‰²åŠ äº®ï¼‰ |
| åŒå‡»è“å›¾èŠ‚ç‚¹ | Scene View èšç„¦åˆ°æ ‡è®°çš„ä»£è¡¨ä½ç½®ï¼ˆFrame Selectedï¼‰ |
| é€‰ä¸­å­è“å›¾ | Scene View ç”¨è™šçº¿æ¡†åœˆå‡ºè¯¥å­è“å›¾ä¸‹æ‰€æœ‰æ ‡è®°çš„åŒ…å›´ç›’ |
| æ‚¬åœè“å›¾èŠ‚ç‚¹ | Scene View å¯¹åº”æ ‡è®°è½»å¾®é«˜äº®ï¼ˆé¢„è§ˆæ•ˆæœï¼‰ |

### 5.2 åœºæ™¯ â†’ è“å›¾

| æ“ä½œ | è“å›¾å“åº” |
|------|---------|
| é€‰ä¸­åœºæ™¯æ ‡è®° | è“å›¾ç¼–è¾‘å™¨é«˜äº®å¼•ç”¨è¯¥æ ‡è®°çš„èŠ‚ç‚¹ + è‡ªåŠ¨æ»šåŠ¨ç”»å¸ƒ |
| åŒå‡»åœºæ™¯æ ‡è®° | è“å›¾ç¼–è¾‘å™¨èšç„¦åˆ°å¯¹åº”èŠ‚ç‚¹ |
| æ¡†é€‰åœºæ™¯åŒºåŸŸ | è“å›¾ç¼–è¾‘å™¨é«˜äº®è¯¥åŒºåŸŸå†…æ‰€æœ‰æ ‡è®°å¯¹åº”çš„èŠ‚ç‚¹ |

### 5.3 å®ç°æœºåˆ¶

```
æ ¸å¿ƒï¼šäº‹ä»¶æ€»çº¿ / ScriptableObject äº‹ä»¶

  SceneMarkerSelectionBridgeï¼ˆScriptableObject å•ä¾‹ï¼‰
    - OnBlueprintNodeSelected(nodeId, markerIds[])
    - OnSceneMarkerSelected(markerId)
    - OnRequestFrameMarker(markerId)
    - OnRequestFrameNode(nodeId)

  è“å›¾ç¼–è¾‘å™¨è®¢é˜…åœºæ™¯ä¾§äº‹ä»¶ï¼Œåœºæ™¯ Gizmo ç»˜åˆ¶å™¨è®¢é˜…è“å›¾ä¾§äº‹ä»¶ã€‚
  ç”¨ SO äº‹ä»¶é¿å…ç›´æ¥å¼•ç”¨ï¼Œä¿æŒ Editor/Runtime åˆ†ç¦»ã€‚
```

---

## 6. åœºæ™¯ Hierarchy ç»„ç»‡

```
åœºæ™¯ä¸­çš„æ ‡è®°å¯¹è±¡æŒ‰å­è“å›¾è‡ªåŠ¨åˆ†ç»„ï¼š

SceneBlueprintMarkers/                    â† æ ¹å®¹å™¨ï¼ˆè‡ªåŠ¨åˆ›å»º/ç®¡ç†ï¼‰
  â”œâ”€â”€ [èµ°å»Šæˆ˜æ–—]/                         â† å­è“å›¾åˆ†ç»„ï¼ˆåç§° = SubGraphFrame.Titleï¼‰
  â”‚   â”œâ”€â”€ TriggerZone_èµ°å»Šå…¥å£             â† AreaMarker
  â”‚   â”œâ”€â”€ SpawnArea_èµ°å»Šä¸­æ®µ               â† AreaMarker
  â”‚   â”œâ”€â”€ SpawnPoint_01                    â† PointMarker
  â”‚   â”œâ”€â”€ SpawnPoint_02                    â† PointMarker
  â”‚   â””â”€â”€ SpawnPoint_03                    â† PointMarker
  â”œâ”€â”€ [å¤§å…Boss]/
  â”‚   â”œâ”€â”€ BossSpawn                        â† EntityMarker
  â”‚   â”œâ”€â”€ CameraRig_Bosså…¥åœº               â† PointMarker
  â”‚   â””â”€â”€ LightingZone_Boss               â† AreaMarker
  â””â”€â”€ [æœªåˆ†ç»„]/                            â† é¡¶å±‚èŠ‚ç‚¹çš„æ ‡è®°
      â””â”€â”€ TriggerZone_å…³å¡å…¥å£             â† AreaMarker

å‘½åè§„åˆ™ï¼š
  - å®¹å™¨å = "SceneBlueprintMarkers"ï¼ˆå›ºå®šï¼‰
  - å­è“å›¾åˆ†ç»„å = SubGraphFrame.Titleï¼ˆè“å›¾ä¸­ä¿®æ”¹åç§°æ—¶åŒæ­¥æ›´æ–°ï¼‰
  - æ ‡è®°å = MarkerType + "_" + MarkerName
```

---

## 7. ä¸ Tag ç³»ç»Ÿçš„é›†æˆ

### 7.1 è‡ªåŠ¨ Tag æ ‡æ³¨

åˆ›å»ºæ ‡è®°æ—¶æ ¹æ® Action çš„ `MarkerRequirement.DefaultTag` è‡ªåŠ¨å¡«å……ï¼š

```
Action ç±»å‹          â†’ æ ‡è®°é»˜è®¤ Tag
Spawn               â†’ Combat.SpawnArea / Combat.SpawnPoint
PlacePreset         â†’ Combat.Entity
TriggerZone         â†’ Trigger.OnEnter
CameraAction        â†’ Camera.Position / Camera.LookAt
PlayVFX             â†’ Environment.VFX
LightingChange      â†’ Environment.Lighting
```

è®¾è®¡å¸ˆå¯åœ¨ Inspector ä¸­æ‰‹åŠ¨ä¿®æ”¹ Tagï¼ˆå¦‚ `Combat.SpawnPoint` â†’ `Combat.SpawnPoint.Elite`ï¼‰ï¼Œå®ç°æ›´ç²¾ç»†çš„åˆ†ç±»ã€‚

### 7.2 Tag è¿‡æ»¤

åœ¨ Tag ç³»ç»Ÿï¼ˆPhase 5ï¼‰å®Œæˆåï¼Œå›¾å±‚è¿‡æ»¤å¯æ‰©å±•ä¸º Tag æ¡ä»¶è¿‡æ»¤ï¼š
- ä¸ä»…æŒ‰å›¾å±‚å¼€å…³ï¼Œè¿˜å¯æŒ‰ Tag è¡¨è¾¾å¼è¿‡æ»¤ï¼ˆå¦‚ "åªæ˜¾ç¤º `Combat.*.Elite`"ï¼‰
- è“å›¾ç¼–è¾‘å™¨ä¸­ä¹Ÿå¯æŒ‰ Tag è¿‡æ»¤èŠ‚ç‚¹é«˜äº®

---

## 8. æ•°æ®æŒä¹…åŒ–

### 8.1 æ ‡è®°æ•°æ®å­˜å‚¨

```
åœºæ™¯æ ‡è®°æ•°æ®å­˜å‚¨åœ¨ä¸¤ä¸ªåœ°æ–¹ï¼š

1. Scene ä¸­çš„ GameObject + SceneMarker ç»„ä»¶
   - éšåœºæ™¯ä¿å­˜ï¼ˆ.unity æ–‡ä»¶ï¼‰
   - åŒ…å«ç©ºé—´æ•°æ®ï¼ˆTransformã€Verticesã€PrefabRef ç­‰ï¼‰
   - åŒ…å« MarkerIdï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰

2. BlueprintAsset (SO) ä¸­çš„ç»‘å®šæ˜ å°„
   - å­˜å‚¨åœ¨ GraphJson ä¸­ï¼Œä½œä¸ºèŠ‚ç‚¹å±æ€§çš„ä¸€éƒ¨åˆ†
   - æ ¼å¼ï¼š{ bindingKey: "spawnArea", markerId: "marker_abc123" }
   - ä¸å­˜å‚¨ç©ºé—´æ•°æ®ï¼ˆç©ºé—´æ•°æ®åªå­˜åœ¨åœºæ™¯ä¸­ï¼Œå•ä¸€æ•°æ®æºï¼‰
```

### 8.2 åŒæ­¥ä¸éªŒè¯

```
æ‰“å¼€è“å›¾ç¼–è¾‘å™¨æ—¶ï¼š
  1. åŠ è½½ BlueprintAsset â†’ è·å–æ‰€æœ‰ markerId å¼•ç”¨
  2. æ‰«æåœºæ™¯ä¸­çš„ SceneMarker ç»„ä»¶ â†’ å»ºç«‹ markerId â†’ GameObject æ˜ å°„
  3. æ ‡è®°ç¼ºå¤±çš„ç»‘å®šï¼ˆæ ‡è®°è¢«åˆ é™¤ä½†èŠ‚ç‚¹ä»å¼•ç”¨ â†’ âš ï¸ è­¦å‘Šï¼‰
  4. æ ‡è®°å­¤ç«‹çš„æ ‡è®°ï¼ˆå­˜åœ¨äºåœºæ™¯ä½†æ²¡æœ‰èŠ‚ç‚¹å¼•ç”¨ â†’ ğŸ’¡ æç¤ºï¼‰

ä¿å­˜æ—¶ï¼š
  - è“å›¾æ•°æ® â†’ BlueprintAsset.GraphJson
  - æ ‡è®°æ•°æ® â†’ éšåœºæ™¯ä¿å­˜ï¼ˆæ— éœ€é¢å¤–æ“ä½œï¼‰
  - ç»‘å®šå…³ç³»çš„ä¸€è‡´æ€§æ£€æŸ¥
```

---

## 9. ç›®å½•ç»“æ„

```
Assets/Extensions/SceneBlueprint/
  â”œâ”€â”€ Runtime/
  â”‚   â”œâ”€â”€ SceneBlueprint.Runtime.asmdef
  â”‚   â”œâ”€â”€ BlueprintAsset.cs                      â† å·²æœ‰
  â”‚   â”œâ”€â”€ Markers/                               â† æ–°å¢
  â”‚   â”‚   â”œâ”€â”€ SceneMarker.cs                     â† æŠ½è±¡åŸºç±»
  â”‚   â”‚   â”œâ”€â”€ PointMarker.cs
  â”‚   â”‚   â”œâ”€â”€ AreaMarker.cs
  â”‚   â”‚   â”œâ”€â”€ EntityMarker.cs
  â”‚   â”‚   â”œâ”€â”€ MarkerType.cs                      â† æšä¸¾
  â”‚   â”‚   â””â”€â”€ MarkerRequirement.cs               â† Action åœºæ™¯éœ€æ±‚å£°æ˜
  â”‚   â””â”€â”€ ...
  â”‚
  â”œâ”€â”€ Editor/
  â”‚   â”œâ”€â”€ SceneBlueprintWindow.cs                â† å·²æœ‰
  â”‚   â”œâ”€â”€ Markers/                               â† æ–°å¢
  â”‚   â”‚   â”œâ”€â”€ SceneMarkerEditor.cs               â† SceneMarker è‡ªå®šä¹‰ Inspector
  â”‚   â”‚   â”œâ”€â”€ AreaMarkerEditor.cs                â† åŒºåŸŸé¡¶ç‚¹ç¼–è¾‘ Handle
  â”‚   â”‚   â”œâ”€â”€ MarkerGizmoDrawer.cs               â† ç»Ÿä¸€ Gizmo ç»˜åˆ¶
  â”‚   â”‚   â”œâ”€â”€ MarkerLayerOverlay.cs              â† Scene View å›¾å±‚åˆ‡æ¢é¢æ¿
  â”‚   â”‚   â”œâ”€â”€ SceneViewMarkerTool.cs             â† å³é”®èœå• + æ”¾ç½®æ¨¡å¼
  â”‚   â”‚   â””â”€â”€ SceneMarkerSelectionBridge.cs      â† åŒå‘è”åŠ¨äº‹ä»¶æ¡¥
  â”‚   â””â”€â”€ ...
  â”‚
  â”œâ”€â”€ Actions/                                   â† å·²æœ‰ï¼šå„ Action ä¸­å¢åŠ  SceneRequirements
  â””â”€â”€ ...
```

---

## 10. å®æ–½è·¯çº¿

### Phase 4B-2 åŒæ­¥å®ç°ï¼ˆåŸºç¡€åŠŸèƒ½ï¼‰

```
æ­¥éª¤ï¼š
  M1. SceneMarker ç»„ä»¶ä½“ç³»ï¼šåŸºç±» + PointMarker + AreaMarker + EntityMarker
  M2. MarkerRequirement æ•°æ®ç»“æ„ + ActionDefinition æ‰©å±•
  M3. MarkerGizmoDrawerï¼šåŸºç¡€ Gizmo ç»˜åˆ¶ï¼ˆé¢œè‰²ã€å›¾æ ‡ã€æ ‡ç­¾ï¼‰
  M4. SceneViewMarkerToolï¼šScene View å³é”®èœå• â†’ åˆ›å»ºæ ‡è®° + è“å›¾èŠ‚ç‚¹ + è‡ªåŠ¨ç»‘å®š
  M5. åœºæ™¯ Hierarchy è‡ªåŠ¨åˆ†ç»„ç®¡ç†

å†’çƒŸæµ‹è¯•ï¼š
  â†’ æ‰“å¼€è“å›¾ç¼–è¾‘å™¨ + Scene View
  â†’ åœ¨ Scene View åœ°é¢å³é”® â†’ "æˆ˜æ–— â†’ åˆ·æ€ª"
  â†’ ç”»å‡ºåˆ·æ€ªåŒºåŸŸ â†’ æ”¾ç½® 3 ä¸ªåˆ·æ€ªç‚¹
  â†’ è“å›¾ä¸­è‡ªåŠ¨å‡ºç° Spawn èŠ‚ç‚¹ï¼ˆå·²ç»‘å®šæ ‡è®°ï¼‰
  â†’ Scene View ä¸­æ ‡è®°æ˜¾ç¤ºçº¢è‰² Gizmo
```

### Phase 5 åæ‰©å±•ï¼ˆTag é›†æˆ + åŒå‘è”åŠ¨ï¼‰

```
æ­¥éª¤ï¼š
  M6. å›¾å±‚ç³»ç»Ÿï¼šTag å‰ç¼€æ˜ å°„ + Scene View Overlay åˆ‡æ¢é¢æ¿
  M7. åŒå‘è”åŠ¨ï¼šSceneMarkerSelectionBridge + é«˜äº® + èšç„¦
  M8. AreaMarkerEditorï¼šå¤šè¾¹å½¢é¡¶ç‚¹å¯è§†åŒ–ç¼–è¾‘ Handle
  M9. éªŒè¯ç³»ç»Ÿï¼šæ‰“å¼€æ—¶æ£€æŸ¥ç»‘å®šä¸€è‡´æ€§ï¼Œæç¤ºç¼ºå¤±/å­¤ç«‹æ ‡è®°

å†’çƒŸæµ‹è¯•ï¼š
  â†’ é€‰ä¸­è“å›¾ä¸­çš„ Spawn èŠ‚ç‚¹ â†’ Scene View è‡ªåŠ¨é«˜äº®åˆ·æ€ªåŒºåŸŸå’Œç‚¹ä½
  â†’ å…³é—­ Camera å›¾å±‚ â†’ æ‘„åƒæœºæ ‡è®° Gizmo éšè—
  â†’ åˆ é™¤åœºæ™¯ä¸­æŸä¸ªæ ‡è®° â†’ è“å›¾èŠ‚ç‚¹æ—æ˜¾ç¤º âš ï¸ ç»‘å®šç¼ºå¤±è­¦å‘Š
```

### Phase 6+ï¼ˆé­é‡æ¨¡æ¿ï¼‰

```
æ­¥éª¤ï¼š
  M10. é­é‡æ¨¡æ¿èµ„äº§ï¼šEncounterTemplate (SO) å­˜å‚¨æ ‡è®°å¸ƒå±€ + å­è“å›¾æ¨¡æ¿
  M11. æ¨¡æ¿åº“é¢æ¿ + æ‹–æ‹½å®ä¾‹åŒ–
  M12. ç©ºé—´çƒ­åŠ›å›¾ï¼šäº‹ä»¶å¯†åº¦å¯è§†åŒ–å åŠ å±‚
```

---

## 11. å¼€æ”¾é—®é¢˜

| é—®é¢˜ | çŠ¶æ€ | å¤‡é€‰æ–¹æ¡ˆ |
|------|------|---------|
| AreaMarker çš„åŒºåŸŸç¼–è¾‘æ–¹å¼ï¼Ÿ | å¾…å®š | A) å¤šè¾¹å½¢é¡¶ç‚¹æ‹–æ‹½ B) Box Handle C) ä¸¤è€…éƒ½æ”¯æŒ |
| æ ‡è®°åˆ é™¤æ—¶æ˜¯å¦è‡ªåŠ¨æ¸…ç†è“å›¾ç»‘å®šï¼Ÿ | å¾…å®š | A) è‡ªåŠ¨æ¸…ç† B) ä¿ç•™å¼•ç”¨+æ ‡è­¦å‘Š C) å¼¹ç¡®è®¤æ¡† |
| å¤šä¸ªè“å›¾å…±äº«åŒä¸€åœºæ™¯çš„æ ‡è®°ï¼Ÿ | å¾…å®š | å½“å‰ä¸€ä¸ªå…³å¡=ä¸€å¼ å›¾ï¼Œæš‚ä¸è€ƒè™‘ |
| EntityMarker è¿è¡Œæ—¶æ˜¯å¦å®ä¾‹åŒ– Prefabï¼Ÿ | å¾…å®š | å–å†³äºè¿è¡Œæ—¶ Handler çš„å®ç°æ–¹å¼ |
