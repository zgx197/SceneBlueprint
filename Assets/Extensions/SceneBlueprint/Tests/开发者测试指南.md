# SceneBlueprint å¼€å‘è€…æµ‹è¯•æŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è¿è¡Œæµ‹è¯•çš„æ–¹å¼

#### **Unity Editor èœå•** (æ¨è)
```
Unity èœå•æ  â†’ SceneBlueprint â†’ Tests â†’ Run All Tests
```

#### **å‘½ä»¤è¡Œæ–¹å¼**
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
Unity -batchmode -runTests -testPlatform EditMode

# è¿è¡Œç‰¹å®šç±»å‹æµ‹è¯•
Unity -batchmode -runTests -testPlatform EditMode -testFilter "Unit"
```

#### **ä»£ç æ–¹å¼**
```csharp
// åœ¨ä»£ç ä¸­è¿è¡Œæµ‹è¯•
var results = TestRunner.RunTests(TestRunner.TestType.All, verbose: true);
bool passed = TestRunner.CheckQualityGate(results);
```

### 2. ç›®å½•ç»“æ„é€Ÿè§ˆ

```
Tests/
â”œâ”€â”€ Unit/Core/              # å•å…ƒæµ‹è¯• (å¿«é€Ÿ, ç‹¬ç«‹)
â”‚   â”œâ”€â”€ ActionDefinitionTests.cs
â”‚   â”œâ”€â”€ PropertyBagTests.cs
â”‚   â”œâ”€â”€ ActionRegistryTests.cs
â”‚   â””â”€â”€ ...
â”œâ”€â”€ Integration/            # é›†æˆæµ‹è¯• (ç»„ä»¶åä½œ)
â”‚   â”œâ”€â”€ FlowActionTests.cs
â”‚   â””â”€â”€ CombatActionTests.cs
â”œâ”€â”€ E2E/                   # ç«¯åˆ°ç«¯æµ‹è¯• (å®Œæ•´æµç¨‹)
â”‚   â””â”€â”€ EndToEndTests.cs
â”œâ”€â”€ Unit/Utils/            # æµ‹è¯•å·¥å…·ç±»
â”‚   â”œâ”€â”€ TestDataBuilder.cs
â”‚   â””â”€â”€ AssertionExtensions.cs
â””â”€â”€ Scripts/               # æµ‹è¯•è‡ªåŠ¨åŒ–è„šæœ¬
    â”œâ”€â”€ TestRunner.cs
    â””â”€â”€ Editor/TestMenuItems.cs
```

## ğŸ“ ç¼–å†™æ–°æµ‹è¯•

### 3. æµ‹è¯•ç¼–å†™æ¨¡æ¿

#### **å•å…ƒæµ‹è¯•æ¨¡æ¿**
```csharp
#nullable enable
using NUnit.Framework;
using SceneBlueprint.Core;
using SceneBlueprint.Tests.Utils;

namespace SceneBlueprint.Tests.Unit.Core
{
    /// <summary>
    /// {ClassName} çš„å•å…ƒæµ‹è¯•
    /// </summary>
    public class {ClassName}Tests
    {
        /// <summary>æµ‹è¯•æ–¹æ³•æè¿°</summary>
        [Test]
        public void Method_Scenario_ExpectedResult()
        {
            // Arrange - å‡†å¤‡æµ‹è¯•æ•°æ®
            var testData = TestDataBuilder.CreateEmptyPropertyBag();
            
            // Act - æ‰§è¡Œæ“ä½œ
            testData.Set("key", "value");
            
            // Assert - éªŒè¯ç»“æœ
            testData.ShouldContainKey("key");
            testData.ShouldContain("key", "value");
        }
    }
}
```

#### **é›†æˆæµ‹è¯•æ¨¡æ¿**
```csharp
namespace SceneBlueprint.Tests.Integration
{
    public class {Feature}IntegrationTests
    {
        private ActionRegistry _registry = null!;

        [SetUp]
        public void Setup()
        {
            _registry = TestDataBuilder.CreateDiscoveredRegistry();
        }

        [Test]
        public void Feature_Integration_WorksCorrectly()
        {
            // æµ‹è¯•å¤šä¸ªç»„ä»¶åä½œ...
        }
    }
}
```

### 4. ä½¿ç”¨æµ‹è¯•å·¥å…·ç±»

#### **TestDataBuilder ä½¿ç”¨**
```csharp
// åˆ›å»ºåŸºç¡€æ•°æ®
var emptyBag = TestDataBuilder.CreateEmptyPropertyBag();
var registry = TestDataBuilder.CreateDiscoveredRegistry();

// åˆ›å»ºå¤åˆæ•°æ®
var spawnNode = TestDataBuilder.CreateSpawnNodeData();
var (registry, nodes) = TestDataBuilder.CreateFullFlowTestData();

// åˆ›å»ºè¾¹ç•Œæ¡ä»¶æ•°æ®
var largeBag = TestDataBuilder.CreateLargePropertyBag(1000);
var invalidDef = TestDataBuilder.CreateInvalidActionDefinition();
```

#### **AssertionExtensions ä½¿ç”¨**
```csharp
// PropertyBag æ–­è¨€
bag.ShouldContainKey("key");
bag.ShouldContain("key", expectedValue);
bag.ShouldHaveCount(5);
bag.ShouldBeEmpty();

// ActionDefinition æ–­è¨€
def.ShouldHaveBasicFields("Combat.Spawn", "åˆ·æ€ª", "Combat");
def.ShouldHavePort("in", PortDirection.In);
def.ShouldHaveProperty("template", PropertyType.AssetRef);

// ActionRegistry æ–­è¨€
registry.ShouldContainAction("Flow.Start");
registry.ShouldHaveCategoryCount("Flow", 5);

// æ€§èƒ½æ–­è¨€
action.ShouldCompleteWithin(1000); // 1ç§’å†…å®Œæˆ

// å¼‚å¸¸æ–­è¨€
(() => registry.Register(invalidDef)).ShouldThrow<ArgumentException>();
```

## ğŸ› ï¸ å¼€å‘å·¥ä½œæµç¨‹

### 5. TDD å¼€å‘æµç¨‹

1. **ç¼–å†™å¤±è´¥æµ‹è¯•** - å…ˆå†™æµ‹è¯•ï¼Œç¡®ä¿å¤±è´¥
2. **å®ç°æœ€å°åŠŸèƒ½** - è®©æµ‹è¯•é€šè¿‡
3. **é‡æ„ä¼˜åŒ–** - ä¿æŒæµ‹è¯•é€šè¿‡
4. **è¿è¡Œå®Œæ•´æµ‹è¯•** - ç¡®ä¿ä¸ç ´åç°æœ‰åŠŸèƒ½

```bash
# å¼€å‘è¿‡ç¨‹ä¸­é¢‘ç¹è¿è¡Œç›¸å…³æµ‹è¯•
Unity Editor â†’ SceneBlueprint â†’ Tests â†’ Run Unit Tests

# å®ŒæˆåŠŸèƒ½åè¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
Unity Editor â†’ SceneBlueprint â†’ Tests â†’ Run All Tests
```

### 6. æäº¤å‰æ£€æŸ¥

```bash
# è¿è¡Œè´¨é‡é—¨ç¦æ£€æŸ¥
Unity Editor â†’ SceneBlueprint â†’ Tests â†’ Quality Gate Check

# æœŸæœ›ç»“æœï¼š
# âœ… æµ‹è¯•æˆåŠŸç‡ â‰¥ 95%
# âœ… æ‰§è¡Œæ—¶é—´ â‰¤ 300s  
# âœ… å¤±è´¥æµ‹è¯•æ•°é‡: 0
```

### 7. å¸¸ç”¨èœå•åŠŸèƒ½

| èœå•é¡¹ | åŠŸèƒ½ | é€‚ç”¨åœºæ™¯ |
|--------|------|----------|
| Run All Tests | è¿è¡Œæ‰€æœ‰æµ‹è¯• | å®Œæ•´éªŒè¯ |
| Run Unit Tests | åªè¿è¡Œå•å…ƒæµ‹è¯• | å¿«é€ŸéªŒè¯æ ¸å¿ƒé€»è¾‘ |
| Run Integration Tests | åªè¿è¡Œé›†æˆæµ‹è¯• | éªŒè¯ç»„ä»¶åä½œ |
| Quality Gate Check | è´¨é‡é—¨ç¦æ£€æŸ¥ | æäº¤å‰éªŒè¯ |
| Generate Test Report | ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š | CI/CD æˆ–æ–‡æ¡£éœ€è¦ |

## ğŸ¯ æµ‹è¯•ç¼–å†™æŒ‡å—

### 8. å‘½åçº¦å®š

| ç±»å‹ | æ ¼å¼ | ç¤ºä¾‹ |
|------|------|------|
| æµ‹è¯•ç±» | `{ClassName}Tests` | `PropertyBagTests` |
| æµ‹è¯•æ–¹æ³• | `Method_Scenario_Expected` | `Get_NonExistentKey_ReturnsDefault` |
| æµ‹è¯•æ–¹æ³• (è¡Œä¸º) | `GivenX_WhenY_ThenZ` | `GivenEmptyBag_WhenSetValue_ThenContainsValue` |

### 9. æµ‹è¯•è¦†ç›–åŸåˆ™

#### **å¿…é¡»æµ‹è¯•çš„åœºæ™¯**
- âœ… æ­£å¸¸æµç¨‹ (Happy Path)
- âœ… è¾¹ç•Œæ¡ä»¶ (ç©ºå€¼ã€æå€¼ã€ä¸´ç•Œå€¼)
- âœ… å¼‚å¸¸æƒ…å†µ (æ— æ•ˆè¾“å…¥ã€é”™è¯¯çŠ¶æ€)
- âœ… æ€§èƒ½è¦æ±‚ (å¤§æ•°æ®é‡ã€æ—¶é—´é™åˆ¶)

#### **å•å…ƒæµ‹è¯•é‡ç‚¹**
- æ¯ä¸ªå…¬å…±æ–¹æ³•è‡³å°‘ä¸€ä¸ªæµ‹è¯•
- æ‰€æœ‰åˆ†æ”¯æ¡ä»¶éƒ½æœ‰æµ‹è¯•è¦†ç›–
- å¼‚å¸¸è·¯å¾„æœ‰ä¸“é—¨æµ‹è¯•
- è¾¹ç•Œå€¼æµ‹è¯• (0, 1, Max, Min)

#### **é›†æˆæµ‹è¯•é‡ç‚¹**
- å¤šç»„ä»¶åä½œåœºæ™¯
- AutoDiscover æœºåˆ¶éªŒè¯
- åºåˆ—åŒ–/ååºåˆ—åŒ–æµç¨‹
- å®Œæ•´ç”¨æˆ·åœºæ™¯æ¨¡æ‹Ÿ

### 10. æµ‹è¯•æ•°æ®ç®¡ç†

#### **æ¨èåšæ³•**
```csharp
// âœ… ä½¿ç”¨ TestDataBuilder
var bag = TestDataBuilder.CreatePropertyBag(("key", "value"));

// âœ… æ¯ä¸ªæµ‹è¯•ç‹¬ç«‹æ•°æ®
[Test]
public void Test1() 
{
    var data = CreateTestData(); // ç‹¬ç«‹åˆ›å»º
}

// âœ… æè¿°æ€§å˜é‡å
var spawnActionWithIntervalTempo = TestDataBuilder.CreateSpawnNodeData();
```

#### **é¿å…åšæ³•**
```csharp
// âŒ ç¡¬ç¼–ç æµ‹è¯•æ•°æ®
var bag = new PropertyBag();
bag.Set("template", "some_hardcoded_template");

// âŒ æµ‹è¯•é—´å…±äº«å¯å˜æ•°æ®  
static PropertyBag sharedBag = new PropertyBag(); // å±é™©ï¼

// âŒ æ— æ„ä¹‰çš„å˜é‡å
var data = new PropertyBag(); // å¤ªæ³›åŒ–
```

## ğŸ”§ æ•…éšœæ’é™¤

### 11. å¸¸è§é—®é¢˜

#### **æµ‹è¯•æ‰¾ä¸åˆ°/æ— æ³•è¿è¡Œ**
- æ£€æŸ¥å‘½åç©ºé—´æ˜¯å¦æ­£ç¡®
- ç¡®è®¤ `[Test]` å±æ€§å­˜åœ¨
- éªŒè¯ asmdef å¼•ç”¨å…³ç³»

#### **æ–­è¨€å¤±è´¥**
```csharp
// âŒ ä¸æ¸…æ™°çš„æ–­è¨€
Assert.IsTrue(result);

// âœ… æ¸…æ™°çš„æ–­è¨€å’Œé”™è¯¯æ¶ˆæ¯  
Assert.IsTrue(registry.TryGet("Flow.Start", out _), 
    "Flow.Start åº”è¯¥è¢« AutoDiscover æ³¨å†Œ");
```

#### **æµ‹è¯•è¿è¡Œç¼“æ…¢**
- æ£€æŸ¥æ˜¯å¦æœ‰è€—æ—¶æ“ä½œæœªä¼˜åŒ–
- ä½¿ç”¨æ€§èƒ½æ–­è¨€ç›‘æ§æ‰§è¡Œæ—¶é—´
- è€ƒè™‘å°†æ…¢æµ‹è¯•ç§»åˆ°é›†æˆæµ‹è¯•å±‚

### 12. è°ƒè¯•æŠ€å·§

```csharp
// ä½¿ç”¨ UnityEngine.Debug è¾“å‡ºè°ƒè¯•ä¿¡æ¯
[Test]
public void Debug_TestData()
{
    var bag = TestDataBuilder.CreateMixedTypePropertyBag();
    Debug.Log($"Bag contents: {PropertyBagSerializer.ToJson(bag)}");
    
    // ç»§ç»­æµ‹è¯•...
}

// ä½¿ç”¨æ¡ä»¶ç¼–è¯‘
#if UNITY_EDITOR
    Debug.Log("ä»…åœ¨ç¼–è¾‘å™¨ä¸­æ˜¾ç¤ºçš„è°ƒè¯•ä¿¡æ¯");
#endif
```

## ğŸ“Š è´¨é‡æ ‡å‡†

### 13. è¦†ç›–ç‡è¦æ±‚

- **Core æ¨¡å—**: â‰¥ 90% è¡Œè¦†ç›–ç‡
- **Actions æ¨¡å—**: â‰¥ 85% è¡Œè¦†ç›–ç‡
- **æ•´ä½“é¡¹ç›®**: â‰¥ 80% è¡Œè¦†ç›–ç‡
- **æ–°å¢ä»£ç **: 100% è¦†ç›–ç‡

### 14. æ€§èƒ½æ ‡å‡†

- å•å…ƒæµ‹è¯•å¥—ä»¶: < 30 ç§’
- é›†æˆæµ‹è¯•å¥—ä»¶: < 2 åˆ†é’Ÿ  
- E2E æµ‹è¯•å¥—ä»¶: < 5 åˆ†é’Ÿ
- å•ä¸ªæµ‹è¯•æ–¹æ³•: < 1 ç§’

### 15. è´¨é‡é—¨ç¦

æäº¤ä»£ç å‰å¿…é¡»æ»¡è¶³ï¼š
- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡
- âœ… è¦†ç›–ç‡è¾¾æ ‡
- âœ… æ€§èƒ½è¦æ±‚æ»¡è¶³
- âœ… æ— ç¼–è¯‘è­¦å‘Š

---

## ğŸš€ ä¸‹ä¸€æ­¥

1. **é˜…è¯»å®Œæ•´æµ‹è¯•æ¡†æ¶æ–‡æ¡£**: `æµ‹è¯•æ¡†æ¶ä¸è´¨é‡ä¿è¯.md`
2. **æŸ¥çœ‹ç¤ºä¾‹æµ‹è¯•**: `Tests/Unit/Core/PropertyBagTests_Example.cs`
3. **è¿è¡Œç¬¬ä¸€ä¸ªæµ‹è¯•**: Unity â†’ SceneBlueprint â†’ Tests â†’ Run All Tests
4. **å¼€å§‹ TDD å¼€å‘**: ç¼–å†™å¤±è´¥æµ‹è¯• â†’ å®ç°åŠŸèƒ½ â†’ é‡æ„ä¼˜åŒ–

**è®°ä½**: å¥½çš„æµ‹è¯•æ˜¯ä»£ç è´¨é‡çš„ä¿éšœï¼ŒæŠ•å…¥æ—¶é—´ç¼–å†™æµ‹è¯•ä¼šåœ¨é•¿æœŸå¼€å‘ä¸­è·å¾—å›æŠ¥ï¼
