# æ³¢æ¬¡åˆ·æ€ªç³»ç»Ÿé‡æ„è®¾è®¡

> **æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
> **åˆ›å»ºæ—¥æœŸ**ï¼š2026-02-19  
> **æœ€åæ›´æ–°**ï¼š2026-02-19  
> **çŠ¶æ€**ï¼šğŸ“ è®¾è®¡ä¸­  
> **é‡è¦æ€§**ï¼šğŸŸ¡ å­ç³»ç»Ÿé‡æ„  
> **å…³è”**ï¼š[SceneBlueprintæ ¸å¿ƒè®¾è®¡åŸåˆ™](SceneBlueprintæ ¸å¿ƒè®¾è®¡åŸåˆ™.md)ã€[æ ‡è®°æ ‡æ³¨ç³»ç»Ÿè®¾è®¡](æ ‡è®°æ ‡æ³¨ç³»ç»Ÿè®¾è®¡.md)ã€[èŠ‚ç‚¹æ¿€æ´»è¯­ä¹‰ä¸æ±‡èšè®¾è®¡](èŠ‚ç‚¹æ¿€æ´»è¯­ä¹‰ä¸æ±‡èšè®¾è®¡.md)  
> **doc_status**: draft  
> **last_reviewed**: 2026-02-19

---

## ç›®å½•

- [ä¸€ã€é—®é¢˜èƒŒæ™¯](#ä¸€é—®é¢˜èƒŒæ™¯)
- [äºŒã€è®¾è®¡ç›®æ ‡](#äºŒè®¾è®¡ç›®æ ‡)
- [ä¸‰ã€æ ¸å¿ƒè®¾è®¡ï¼šèŒè´£æ‹†åˆ†](#ä¸‰æ ¸å¿ƒè®¾è®¡èŒè´£æ‹†åˆ†)
- [å››ã€WaveSpawnConfig é‡æ„](#å››wavespawnconfig-é‡æ„)
- [äº”ã€Spawn.Wave èŠ‚ç‚¹é‡æ„](#äº”spawnwave-èŠ‚ç‚¹é‡æ„)
- [å…­ã€SpawnWaveSystem é‡æ„](#å…­spawnwavesystem-é‡æ„)
- [ä¸ƒã€Blueprint ç»„åˆç¤ºä¾‹](#ä¸ƒblueprint-ç»„åˆç¤ºä¾‹)
- [å…«ã€å¯¼å‡ºæ•°æ®æ ¼å¼](#å…«å¯¼å‡ºæ•°æ®æ ¼å¼)
- [ä¹ã€è¿ç§»æ–¹æ¡ˆ](#ä¹è¿ç§»æ–¹æ¡ˆ)
- [åã€å®æ–½è·¯çº¿](#åå®æ–½è·¯çº¿)
- [åä¸€ã€è®¾è®¡å†³ç­–è®°å½•](#åä¸€è®¾è®¡å†³ç­–è®°å½•)

---

## ä¸€ã€é—®é¢˜èƒŒæ™¯

### 1.1 ç°çŠ¶åˆ†æ

å½“å‰æ³¢æ¬¡åˆ·æ€ªç³»ç»Ÿç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š

- `WaveSpawnConfig`ï¼ˆSceneView å±‚æ ‡æ³¨ç»„ä»¶ï¼‰ï¼šæŒ‚åœ¨ AreaMarker ä¸Šï¼Œé…ç½®æ€ªç‰©æ±  + æ³¢æ¬¡è§„åˆ™
- `Spawn.Wave`ï¼ˆBlueprint èŠ‚ç‚¹ï¼‰ï¼šå¼•ç”¨å¸¦æœ‰ WaveSpawnConfig çš„ AreaMarkerï¼Œè¿è¡Œæ—¶æŒ‰æ³¢æ¬¡åˆ·æ€ª

### 1.2 å­˜åœ¨çš„é—®é¢˜

**é—®é¢˜ 1ï¼šè¯­ä¹‰ä¸æ˜ç¡®**

```
å½“å‰ WaveSpawnConfig.MonsterEntry.count çš„å«ä¹‰ï¼š
  ç­–åˆ’è§†è§’ï¼š"è¿™ä¸ªæ•°å­—æ˜¯æ¯æ³¢çš„æ•°é‡ï¼Ÿè¿˜æ˜¯æ‰€æœ‰æ³¢æ¬¡çš„æ€»æ•°é‡ï¼Ÿ"
  å®é™…ä»£ç ï¼šæ¯æ³¢éƒ½ä¼šç”Ÿæˆ Monsters æ•°ç»„ä¸­æ‰€æœ‰æ¡ç›®çš„ count æ•°é‡
  â†’ è¯­ä¹‰ä¸ç›´è§‚ï¼Œå®¹æ˜“è¯¯è§£
```

**é—®é¢˜ 2ï¼šèŒè´£è¾¹ç•Œæ¨¡ç³Š**

æ ¹æ® [SceneBlueprintæ ¸å¿ƒè®¾è®¡åŸåˆ™](SceneBlueprintæ ¸å¿ƒè®¾è®¡åŸåˆ™.md) Â§1.2ï¼š

| æ•°æ® | åº”å±äºçš„å±‚ | å½“å‰å®é™…ä½ç½® | æ˜¯å¦åˆç† |
|------|-----------|-------------|---------|
| æ€ªç‰©æ± ï¼ˆåˆ·ä»€ä¹ˆæ€ªï¼‰ | SceneView å±‚ | WaveSpawnConfig âœ… | åˆç† |
| æ³¢æ¬¡æ•°é‡ï¼ˆåˆ·å‡ æ³¢ï¼‰ | Blueprint å±‚ | WaveSpawnConfig âŒ | **ä¸åˆç†** |
| æ³¢æ¬¡é—´éš”ï¼ˆå¤šä¹…åˆ·ä¸€æ³¢ï¼‰ | Blueprint å±‚ | WaveSpawnConfig âŒ | **ä¸åˆç†** |
| æ¯æ³¢æ•°é‡ï¼ˆæ¯æ³¢åˆ·å‡ ä¸ªï¼‰ | Blueprint å±‚ | WaveSpawnConfig âŒ | **ä¸åˆç†** |

æ³¢æ¬¡æ•°é‡ã€é—´éš”ã€æ¯æ³¢æ•°é‡å±äº"è¿è¡Œæ—¶é€»è¾‘é…ç½®"ï¼Œåº”è¯¥åœ¨ Blueprint å±‚ç®¡ç†ã€‚

**é—®é¢˜ 3ï¼šçµæ´»æ€§ä¸è¶³**

å½“å‰è®¾è®¡æ— æ³•å®ç°ä»¥ä¸‹å¸¸è§éœ€æ±‚ï¼š

| éœ€æ±‚ | å½“å‰èƒ½å¦å®ç° | åŸå›  |
|------|------------|------|
| å˜é€Ÿåˆ·æ€ªï¼ˆå‰æ…¢åå¿«ï¼‰ | âŒ | æ‰€æœ‰æ³¢æ¬¡å…±äº«å›ºå®šé—´éš” |
| æœ€åä¸€æ³¢åˆ· Boss | âŒ | æ‰€æœ‰æ³¢æ¬¡ä½¿ç”¨ç›¸åŒæ€ªç‰©æ±  |
| ç²¾è‹±æ€ªæŒ‰é—´éš”åˆ· | âŒ | æ— æ³•ä¸ºç‰¹å®šæ³¢æ¬¡æŒ‡å®šä¸åŒæ€ªç‰© |
| ç‰¹å®šæ³¢æ¬¡è§¦å‘äº‹ä»¶ï¼ˆå±å¹•éœ‡åŠ¨ï¼‰ | âŒ | æ— äº‹ä»¶ç«¯å£ |
| æ¯æ³¢ä¸åŒæ•°é‡ | âŒ | æ‰€æœ‰æ³¢æ¬¡æ•°é‡ç›¸åŒ |

### 1.3 æ ¹æœ¬åŸå› 

**WaveSpawnConfig æ‰¿æ‹…äº†è¿‡å¤šèŒè´£**â€”â€”å®ƒæ—¢æè¿°"è¿™ä¸ªåŒºåŸŸèƒ½åˆ·ä»€ä¹ˆæ€ª"ï¼ˆç©ºé—´æ ‡æ³¨ï¼‰ï¼Œåˆæè¿°"æ€ä¹ˆåˆ·ã€åˆ·å‡ æ³¢ã€é—´éš”å¤šä¹…"ï¼ˆè¿è¡Œæ—¶é€»è¾‘ï¼‰ã€‚

è¿™è¿åäº†æ ¸å¿ƒè®¾è®¡åŸåˆ™ä¸­çš„èŒè´£åˆ†ç¦»ï¼š
- SceneView å±‚åº”è¯¥åªå›ç­”"åœ¨å“ªé‡Œåˆ·ä»€ä¹ˆæ€ª"
- Blueprint å±‚åº”è¯¥å›ç­”"ä½•æ—¶åˆ·ã€åˆ·å‡ æ³¢ã€æ¯æ³¢å¤šå°‘ã€é—´éš”å¤šä¹…"

---

## äºŒã€è®¾è®¡ç›®æ ‡

### 2.1 åŠŸèƒ½ç›®æ ‡

1. æ”¯æŒæ¯æ³¢ç‹¬ç«‹é…ç½®ï¼šæ•°é‡ã€é—´éš”ã€æ€ªç‰©ç­›é€‰
2. æ”¯æŒå˜é€Ÿåˆ·æ€ªï¼ˆæ¯æ³¢é—´éš”å¯ä¸åŒï¼‰
3. æ”¯æŒç‰¹å®šæ³¢æ¬¡è§¦å‘äº‹ä»¶ï¼ˆé€šè¿‡ Blueprint ç«¯å£ï¼‰
4. æ”¯æŒ Boss æ³¢ / ç²¾è‹±æ³¢ï¼ˆé€šè¿‡æ€ªç‰©ç­›é€‰å™¨ï¼‰
5. ä¿æŒç®€å•åœºæ™¯çš„é…ç½®ç®€æ´æ€§

### 2.2 è®¾è®¡ç›®æ ‡

1. **èŒè´£æ¸…æ™°**ï¼šWaveSpawnConfig åªæè¿°æ€ªç‰©æ± ï¼Œæ³¢æ¬¡é€»è¾‘åœ¨ Blueprint ä¸­
2. **ç­–åˆ’å‹å¥½**ï¼šç®€å•åœºæ™¯ 3 åˆ†é’Ÿé…å®Œï¼Œå¤æ‚åœºæ™¯é€šè¿‡ Blueprint ç»„åˆå®ç°
3. **ç¬¦åˆç³»ç»Ÿè®¾è®¡åŸåˆ™**ï¼šéµå¾ªåœºæ™¯ä¸­å¿ƒåŒ–ã€èŒè´£åˆ†ç¦»ã€å•å‘æ•°æ®æµ
4. **å‘åå…¼å®¹**ï¼šæä¾›æ¸…æ™°çš„è¿ç§»è·¯å¾„

### 2.3 éç›®æ ‡

- ä¸å®ç°æ³¢æ¬¡æ¨¡æ¿ç³»ç»Ÿï¼ˆåç»­è¿­ä»£ï¼‰
- ä¸å®ç°è‡ªå®šä¹‰ Inspector ç¼–è¾‘å™¨ï¼ˆä½¿ç”¨ Unity é»˜è®¤ Inspectorï¼‰
- ä¸ä¿®æ”¹å¯¼å‡ºå™¨çš„æ•´ä½“æ¶æ„

---

## ä¸‰ã€æ ¸å¿ƒè®¾è®¡ï¼šèŒè´£æ‹†åˆ†

### 3.1 æ‹†åˆ†å‰åå¯¹æ¯”

```
â•â•â• æ‹†åˆ†å‰ â•â•â•

WaveSpawnConfigï¼ˆSceneView å±‚ï¼‰
  â”œâ”€ Monsters[]          â† æ€ªç‰©æ± ï¼ˆç©ºé—´æ ‡æ³¨ï¼‰âœ…
  â”œâ”€ WaveCount           â† æ³¢æ¬¡æ•°é‡ï¼ˆè¿è¡Œæ—¶é€»è¾‘ï¼‰âŒ
  â”œâ”€ WaveIntervalTicks   â† æ³¢æ¬¡é—´éš”ï¼ˆè¿è¡Œæ—¶é€»è¾‘ï¼‰âŒ
  â””â”€ MinSpacing          â† æœ€å°é—´è·ï¼ˆç©ºé—´æ ‡æ³¨ï¼‰âœ…

Spawn.Wave èŠ‚ç‚¹ï¼ˆBlueprint å±‚ï¼‰
  â”œâ”€ in ç«¯å£
  â”œâ”€ out ç«¯å£ï¼ˆæ‰€æœ‰æ³¢æ¬¡å®Œæˆåè§¦å‘ï¼‰
  â””â”€ spawnArea ç»‘å®š

â•â•â• æ‹†åˆ†å â•â•â•

WaveSpawnConfigï¼ˆSceneView å±‚ï¼‰â€”â€” åªæè¿°æ€ªç‰©æ± 
  â”œâ”€ Monsters[]          â† æ€ªç‰©æ± ï¼ˆç©ºé—´æ ‡æ³¨ï¼‰
  â”‚   â”œâ”€ monsterId       â† æ€ªç‰©æ¨¡æ¿ ID
  â”‚   â”œâ”€ level           â† æ€ªç‰©ç­‰çº§
  â”‚   â”œâ”€ behavior        â† åˆå§‹è¡Œä¸º
  â”‚   â”œâ”€ guardRadius     â† è­¦æˆ’åŠå¾„
  â”‚   â””â”€ tag             â† åˆ†ç±»æ ‡ç­¾ï¼ˆæ–°å¢ï¼Œç”¨äºç­›é€‰ï¼‰
  â””â”€ MinSpacing          â† æœ€å°é—´è·ï¼ˆç©ºé—´æ ‡æ³¨ï¼‰

Spawn.Wave èŠ‚ç‚¹ï¼ˆBlueprint å±‚ï¼‰â€”â€” æè¿°æ³¢æ¬¡é€»è¾‘
  â”œâ”€ in ç«¯å£
  â”œâ”€ out ç«¯å£ï¼ˆæ‰€æœ‰æ³¢æ¬¡å®Œæˆåè§¦å‘ï¼‰
  â”œâ”€ onWaveStart ç«¯å£ï¼ˆæ–°å¢ï¼Œæ¯æ³¢å¼€å§‹æ—¶è§¦å‘ï¼‰
  â”œâ”€ spawnArea ç»‘å®š
  â””â”€ Waves[] å±æ€§ï¼ˆæ–°å¢ï¼Œæ³¢æ¬¡é…ç½®åˆ—è¡¨ï¼‰
      â”œâ”€ count           â† æœ¬æ³¢åˆ·æ€ªæ•°é‡
      â”œâ”€ intervalTicks   â† è·ä¸Šä¸€æ³¢çš„é—´éš”
      â””â”€ monsterFilter   â† æ€ªç‰©ç­›é€‰æ ‡ç­¾ï¼ˆå¯é€‰ï¼‰
```

### 3.2 èŒè´£è¾¹ç•Œ

| æ•°æ® | æ‰€å±å±‚ | é…ç½®ä½ç½® | è¯´æ˜ |
|------|--------|---------|------|
| æ€ªç‰©æ¨¡æ¿ ID | SceneView | WaveSpawnConfig.Monsters[].monsterId | "è¿™ä¸ªåŒºåŸŸèƒ½åˆ·éª·é«…å…µ" |
| æ€ªç‰©ç­‰çº§ | SceneView | WaveSpawnConfig.Monsters[].level | "éª·é«…å…µç­‰çº§ 3" |
| æ€ªç‰©åˆå§‹è¡Œä¸º | SceneView | WaveSpawnConfig.Monsters[].behavior | "éª·é«…å…µç”Ÿæˆåå·¡é€»" |
| æ€ªç‰©åˆ†ç±»æ ‡ç­¾ | SceneView | WaveSpawnConfig.Monsters[].tag | "è¿™æ˜¯æ™®é€šæ€ª / ç²¾è‹± / Boss" |
| æœ€å°é—´è· | SceneView | WaveSpawnConfig.MinSpacing | "æ€ªç‰©ä¹‹é—´è‡³å°‘ 1.5 ç±³" |
| æ³¢æ¬¡æ•°é‡ | Blueprint | Spawn.Wave.Waves.Length | "åˆ· 5 æ³¢" |
| æ¯æ³¢æ•°é‡ | Blueprint | Spawn.Wave.Waves[].count | "ç¬¬ 1 æ³¢åˆ· 5 ä¸ª" |
| æ³¢æ¬¡é—´éš” | Blueprint | Spawn.Wave.Waves[].intervalTicks | "ç¬¬ 2 æ³¢ç­‰ 60 Tick" |
| æ€ªç‰©ç­›é€‰ | Blueprint | Spawn.Wave.Waves[].monsterFilter | "ç¬¬ 5 æ³¢åªåˆ· Boss" |

### 3.3 æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SceneView å±‚                â”‚
â”‚                              â”‚
â”‚  AreaMarker                  â”‚
â”‚    â””â”€ WaveSpawnConfig        â”‚
â”‚        â”œâ”€ Monsters[]         â”‚  "è¿™ä¸ªåŒºåŸŸèƒ½åˆ·ä»€ä¹ˆæ€ª"
â”‚        â”‚   â”œâ”€ éª·é«…æˆ˜å£« (Normal)
â”‚        â”‚   â”œâ”€ éª·é«…å¼“æ‰‹ (Normal)
â”‚        â”‚   â”œâ”€ éª·é«…æ³•å¸ˆ (Elite)
â”‚        â”‚   â””â”€ éª·é«…ç‹ (Boss)
â”‚        â””â”€ MinSpacing: 1.5    â”‚
â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ SceneBindingï¼ˆMarkerId åªè¯»å¼•ç”¨ï¼‰
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Blueprint å±‚                â”‚
â”‚                              â”‚
â”‚  [Spawn.Wave]                â”‚
â”‚    â”œâ”€ spawnArea: AreaMarker  â”‚  "åœ¨é‚£ä¸ªåŒºåŸŸåˆ·"
â”‚    â””â”€ Waves:                 â”‚  "æ€ä¹ˆåˆ·"
â”‚        â”œâ”€ æ³¢æ¬¡1: 5ä¸ª, 0 Tick,  Normal
â”‚        â”œâ”€ æ³¢æ¬¡2: 5ä¸ª, 60 Tick, Normal
â”‚        â”œâ”€ æ³¢æ¬¡3: 3ä¸ª, 60 Tick, Elite
â”‚        â”œâ”€ æ³¢æ¬¡4: 5ä¸ª, 45 Tick, Normal
â”‚        â””â”€ æ³¢æ¬¡5: 1ä¸ª, 90 Tick, Boss
â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ å¯¼å‡º
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¿è¡Œæ—¶                      â”‚
â”‚                              â”‚
â”‚  SpawnWaveSystem æŒ‰æ³¢æ¬¡æ‰§è¡Œï¼šâ”‚
â”‚    æ³¢æ¬¡1 â†’ ä» Normal æ± æŠ½ 5 ä¸ª
â”‚    ç­‰ 60 Tick                â”‚
â”‚    æ³¢æ¬¡2 â†’ ä» Normal æ± æŠ½ 5 ä¸ª
â”‚    ç­‰ 60 Tick                â”‚
â”‚    æ³¢æ¬¡3 â†’ ä» Elite æ± æŠ½ 3 ä¸ª
â”‚    ç­‰ 45 Tick                â”‚
â”‚    æ³¢æ¬¡4 â†’ ä» Normal æ± æŠ½ 5 ä¸ª
â”‚    ç­‰ 90 Tick                â”‚
â”‚    æ³¢æ¬¡5 â†’ ä» Boss æ± æŠ½ 1 ä¸ª â”‚
â”‚    â†’ Completed               â”‚
â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å››ã€WaveSpawnConfig é‡æ„

### 4.1 é‡æ„åçš„æ•°æ®ç»“æ„

```csharp
[AddComponentMenu("SceneBlueprint/Annotations/Wave Spawn Config")]
public class WaveSpawnConfig : MarkerAnnotation
{
    public override string AnnotationTypeId => "WaveSpawn";

    [Serializable]
    public struct MonsterEntry
    {
        [Tooltip("æ€ªç‰©æ¨¡æ¿ ID")]
        public string monsterId;

        [Tooltip("æ€ªç‰©ç­‰çº§")]
        [Range(1, 100)]
        public int level;

        [Tooltip("åˆå§‹è¡Œä¸º")]
        public InitialBehavior behavior;

        [Tooltip("è­¦æˆ’åŠå¾„ï¼ˆä»… Guard ç”Ÿæ•ˆï¼‰")]
        [Min(0.5f)]
        public float guardRadius;

        [Tooltip("åˆ†ç±»æ ‡ç­¾ï¼ˆç”¨äºæ³¢æ¬¡ç­›é€‰ï¼Œå¦‚ Normal / Elite / Bossï¼‰")]
        public MonsterTag tag;

        [Tooltip("æƒé‡ï¼ˆåŒæ ‡ç­¾å†…éšæœºæŠ½å–æ—¶çš„æƒé‡ï¼‰")]
        [Range(1, 100)]
        public int weight;
    }

    /// <summary>æ€ªç‰©åˆ†ç±»æ ‡ç­¾</summary>
    public enum MonsterTag
    {
        Normal,     // æ™®é€šæ€ª
        Elite,      // ç²¾è‹±æ€ª
        Boss,       // Boss
        Minion,     // å°å…µ/å¬å”¤ç‰©
        Special     // ç‰¹æ®Šï¼ˆè‡ªå®šä¹‰ç”¨é€”ï¼‰
    }

    [Header("æ€ªç‰©æ± ")]
    [Tooltip("è¯¥åŒºåŸŸå¯åˆ·å‡ºçš„æ€ªç‰©åˆ—è¡¨")]
    public MonsterEntry[] Monsters = Array.Empty<MonsterEntry>();

    [Header("ç©ºé—´è®¾ç½®")]
    [Tooltip("æ€ªç‰©ä¹‹é—´çš„æœ€å°é—´è·")]
    [Min(0.5f)]
    public float MinSpacing = 1.5f;

    // â”€â”€â”€ å·²ç§»é™¤çš„å­—æ®µ â”€â”€â”€
    // WaveCount        â†’ ç§»è‡³ Spawn.Wave èŠ‚ç‚¹çš„ Waves[] å±æ€§
    // WaveIntervalTicks â†’ ç§»è‡³ Spawn.Wave èŠ‚ç‚¹çš„ Waves[].intervalTicks

    public override void CollectExportData(IDictionary<string, object> data)
    {
        data["monsters"] = JsonUtility.ToJson(new MonsterListWrapper { items = Monsters });
        data["minSpacing"] = MinSpacing;
    }
}
```

### 4.2 ä¸æ—§ç‰ˆçš„å·®å¼‚

| å­—æ®µ | æ—§ç‰ˆ | æ–°ç‰ˆ | å˜åŒ–è¯´æ˜ |
|------|------|------|---------|
| `Monsters[].monsterId` | âœ… | âœ… | ä¸å˜ |
| `Monsters[].level` | âœ… | âœ… | ä¸å˜ |
| `Monsters[].behavior` | âœ… | âœ… | ä¸å˜ |
| `Monsters[].guardRadius` | âœ… | âœ… | ä¸å˜ |
| `Monsters[].count` | âœ… | âŒ ç§»é™¤ | ç§»è‡³ Spawn.Wave èŠ‚ç‚¹çš„ Waves[].count |
| `Monsters[].tag` | âŒ | âœ… æ–°å¢ | åˆ†ç±»æ ‡ç­¾ï¼Œç”¨äºæ³¢æ¬¡ç­›é€‰ |
| `Monsters[].weight` | âŒ | âœ… æ–°å¢ | éšæœºæŠ½å–æƒé‡ |
| `WaveCount` | âœ… | âŒ ç§»é™¤ | ç§»è‡³ Spawn.Wave èŠ‚ç‚¹ |
| `WaveIntervalTicks` | âœ… | âŒ ç§»é™¤ | ç§»è‡³ Spawn.Wave èŠ‚ç‚¹ |
| `MinSpacing` | âœ… | âœ… | ä¸å˜ |

### 4.3 Inspector æ˜¾ç¤ºæ•ˆæœ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Wave Spawn Config                   â”‚
â”‚                                     â”‚
â”‚ æ€ªç‰©æ±                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Element 0                       â”‚ â”‚
â”‚ â”‚   Monster Id: [skeleton_warrior]â”‚ â”‚
â”‚ â”‚   Level: [3]                    â”‚ â”‚
â”‚ â”‚   Behavior: [Patrol â–¼]         â”‚ â”‚
â”‚ â”‚   Guard Radius: [5]            â”‚ â”‚
â”‚ â”‚   Tag: [Normal â–¼]              â”‚ â”‚
â”‚ â”‚   Weight: [50]                  â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ Element 1                       â”‚ â”‚
â”‚ â”‚   Monster Id: [skeleton_mage]   â”‚ â”‚
â”‚ â”‚   Level: [5]                    â”‚ â”‚
â”‚ â”‚   Behavior: [Guard â–¼]          â”‚ â”‚
â”‚ â”‚   Guard Radius: [8]            â”‚ â”‚
â”‚ â”‚   Tag: [Elite â–¼]               â”‚ â”‚
â”‚ â”‚   Weight: [30]                  â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ Element 2                       â”‚ â”‚
â”‚ â”‚   Monster Id: [skeleton_king]   â”‚ â”‚
â”‚ â”‚   Level: [10]                   â”‚ â”‚
â”‚ â”‚   Behavior: [Idle â–¼]           â”‚ â”‚
â”‚ â”‚   Guard Radius: [0.5]          â”‚ â”‚
â”‚ â”‚   Tag: [Boss â–¼]                â”‚ â”‚
â”‚ â”‚   Weight: [100]                 â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚ ç©ºé—´è®¾ç½®                            â”‚
â”‚   Min Spacing: [1.5]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.4 Gizmo æ˜¾ç¤ºæ›´æ–°

é‡æ„å Gizmo æ ‡ç­¾æ˜¾ç¤ºæ€ªç‰©æ± æ¦‚è¦ï¼ˆä¸å†æ˜¾ç¤ºæ³¢æ¬¡ä¿¡æ¯ï¼‰ï¼š

```csharp
public override void DrawGizmoDecoration(bool isSelected)
{
    if (Monsters.Length == 0) return;

    // ç»Ÿè®¡å„æ ‡ç­¾çš„æ€ªç‰©æ•°é‡
    int normalCount = 0, eliteCount = 0, bossCount = 0;
    foreach (var m in Monsters)
    {
        switch (m.tag)
        {
            case MonsterTag.Normal: normalCount++; break;
            case MonsterTag.Elite: eliteCount++; break;
            case MonsterTag.Boss: bossCount++; break;
        }
    }

    var labelPos = transform.position + Vector3.up * 2.5f;
    var parts = new List<string>();
    if (normalCount > 0) parts.Add($"æ™®é€šx{normalCount}");
    if (eliteCount > 0) parts.Add($"ç²¾è‹±x{eliteCount}");
    if (bossCount > 0) parts.Add($"Bossx{bossCount}");
    var label = $"æ€ªç‰©æ±  ({string.Join(", ", parts)})";

    // ç»˜åˆ¶æ ‡ç­¾...
}
```

---

## äº”ã€Spawn.Wave èŠ‚ç‚¹é‡æ„

### 5.1 èŠ‚ç‚¹å®šä¹‰

```csharp
[ActionType("Spawn.Wave")]
public class SpawnWaveActionDef : IActionDefinitionProvider
{
    public ActionDefinition Define() => new ActionDefinition
    {
        TypeId = "Spawn.Wave",
        DisplayName = "æ³¢æ¬¡åˆ·æ€ª",
        Category = "Spawn",
        Description = "åœ¨åŒºåŸŸå†…æŒ‰æ³¢æ¬¡éšæœºç”Ÿæˆæ€ªç‰©ï¼ˆç»‘å®šå¸¦ WaveSpawnConfig çš„ AreaMarkerï¼‰",
        ThemeColor = new Color4(0.2f, 0.7f, 0.3f),
        Duration = ActionDuration.Duration,
        Ports = new[]
        {
            Port.In("in", "è¾“å…¥"),
            Port.Out("out", "å…¨éƒ¨å®Œæˆ"),
            Port.Out("onWaveStart", "æ¯æ³¢å¼€å§‹"),  // æ–°å¢
        },
        Properties = new[]
        {
            Prop.SceneBinding("spawnArea", "åˆ·æ€ªåŒºåŸŸ", BindingType.Area, order: 0),
            Prop.WaveList("waves", "æ³¢æ¬¡é…ç½®", order: 1),  // æ–°å¢
        },
        SceneRequirements = new[]
        {
            new MarkerRequirement("spawnArea", MarkerTypeIds.Area,
                required: true, displayName: "åˆ·æ€ªåŒºåŸŸ"),
        }
    };
}
```

### 5.2 æ³¢æ¬¡é…ç½®æ•°æ®ç»“æ„

```csharp
/// <summary>
/// å•ä¸ªæ³¢æ¬¡çš„é…ç½®ã€‚
/// å­˜å‚¨åœ¨ Spawn.Wave èŠ‚ç‚¹çš„ Properties ä¸­ï¼Œå¯¼å‡ºä¸º JSON æ•°ç»„ã€‚
/// </summary>
[Serializable]
public struct WaveEntry
{
    [Tooltip("æœ¬æ³¢åˆ·æ€ªæ•°é‡")]
    [Min(1)]
    public int count;

    [Tooltip("è·ä¸Šä¸€æ³¢çš„é—´éš”ï¼ˆTick æ•°ï¼Œé¦–æ³¢ä¸º 0 è¡¨ç¤ºç«‹å³å¼€å§‹ï¼‰")]
    [Min(0)]
    public int intervalTicks;

    [Tooltip("æ€ªç‰©ç­›é€‰æ ‡ç­¾ï¼ˆç•™ç©ºæˆ– All è¡¨ç¤ºä½¿ç”¨å…¨éƒ¨æ€ªç‰©æ± ï¼‰")]
    public string monsterFilter;
}
```

### 5.3 ç«¯å£è¯­ä¹‰

| ç«¯å£ | æ–¹å‘ | è§¦å‘æ—¶æœº | æºå¸¦æ•°æ® | ç”¨é€” |
|------|------|---------|---------|------|
| `in` | Input | ä¸Šæ¸¸èŠ‚ç‚¹å®Œæˆæ—¶ | â€” | å¯åŠ¨æ³¢æ¬¡åˆ·æ€ª |
| `out` | Output | æ‰€æœ‰æ³¢æ¬¡å®Œæˆå | â€” | è§¦å‘åç»­èŠ‚ç‚¹ |
| `onWaveStart` | Output | æ¯æ³¢å¼€å§‹ç”Ÿæˆå‰ | waveIndexï¼ˆå½“å‰æ³¢æ¬¡ç´¢å¼•ï¼‰ | è§¦å‘æ³¢æ¬¡äº‹ä»¶ï¼ˆå±å¹•éœ‡åŠ¨ã€éŸ³æ•ˆç­‰ï¼‰ |

**`onWaveStart` ç«¯å£çš„è®¾è®¡è€ƒé‡**ï¼š

- æ¯æ³¢å¼€å§‹æ—¶è§¦å‘ä¸€æ¬¡ï¼Œç­–åˆ’å¯ä»¥è¿æ¥åˆ° `Flow.Branch` åˆ¤æ–­æ³¢æ¬¡ç´¢å¼•
- ä¸é˜»å¡åˆ·æ€ªæµç¨‹â€”â€”è§¦å‘åç«‹å³ç»§ç»­ç”Ÿæˆæ€ªç‰©
- å¦‚æœä¸è¿æ¥ä»»ä½•ä¸‹æ¸¸èŠ‚ç‚¹ï¼Œä¸äº§ç”Ÿä»»ä½•å¼€é”€

### 5.4 å±æ€§åºåˆ—åŒ–

æ³¢æ¬¡é…ç½®åˆ—è¡¨åœ¨å¯¼å‡ºæ—¶åºåˆ—åŒ–ä¸º JSON æ•°ç»„ï¼Œå­˜å‚¨åœ¨ `Properties` ä¸­ï¼š

```json
{
    "Key": "waves",
    "ValueType": "json",
    "Value": "[{\"count\":5,\"intervalTicks\":0,\"monsterFilter\":\"Normal\"},{\"count\":5,\"intervalTicks\":60,\"monsterFilter\":\"Normal\"},{\"count\":1,\"intervalTicks\":90,\"monsterFilter\":\"Boss\"}]"
}
```

---

## å…­ã€SpawnWaveSystem é‡æ„

### 6.1 è¿è¡Œæ—¶çŠ¶æ€ç®¡ç†

```
ActionRuntimeState å­—æ®µä½¿ç”¨ï¼š
  CustomInt   â†’ å½“å‰æ³¢æ¬¡ç´¢å¼•ï¼ˆ0-basedï¼‰
  CustomFloat â†’ ä¸Šæ¬¡åˆ·æ€ªçš„ Tick æ—¶é—´æˆ³
  TicksInPhase â†’ è‡ªåŠ¨é€’å¢ï¼ˆç”± Runner ç®¡ç†ï¼‰
```

### 6.2 æ‰§è¡Œæµç¨‹

```
SpawnWaveSystem.ProcessWaveAction(frame, actionIndex, state):

  1. è§£æ SceneBinding â†’ è·å–åŒºåŸŸå‡ ä½• + WaveSpawnConfig æ€ªç‰©æ± 
  2. è§£æ Properties["waves"] â†’ è·å–æ³¢æ¬¡é…ç½®åˆ—è¡¨ WaveEntry[]
  3. è¯»å–å½“å‰æ³¢æ¬¡ç´¢å¼• currentWave = state.CustomInt
  4. è¯»å–ä¸Šæ¬¡åˆ·æ€ª Tick = state.CustomFloat

  5. åˆ¤æ–­æ˜¯å¦è¯¥åˆ·ä¸‹ä¸€æ³¢ï¼š
     â”œâ”€ é¦–æ³¢ï¼ˆcurrentWave == 0 ä¸” CustomFloat == 0ï¼‰â†’ ç«‹å³åˆ·
     â””â”€ åç»­æ³¢æ¬¡ â†’ æ£€æŸ¥é—´éš”æ˜¯å¦å·²è¿‡

  6. åˆ·æ€ªï¼š
     a. è¯»å– WaveEntry[currentWave]
     b. æ ¹æ® monsterFilter ä»æ€ªç‰©æ± ä¸­ç­›é€‰å€™é€‰æ€ªç‰©
     c. æŒ‰ weight æƒé‡éšæœºæŠ½å– count ä¸ªæ€ªç‰©
     d. åœ¨åŒºåŸŸå†…ç”Ÿæˆéšæœºä½ç½®ï¼ˆæ»¡è¶³ MinSpacingï¼‰
     e. é€šè¿‡ ISpawnHandler å›è°ƒåˆ›å»ºæ€ªç‰©

  7. è§¦å‘ onWaveStart ç«¯å£äº‹ä»¶ï¼ˆå¦‚æœæœ‰ä¸‹æ¸¸è¿æ¥ï¼‰

  8. é€’å¢æ³¢æ¬¡ç´¢å¼•ï¼Œè®°å½•å½“å‰ Tick
  9. å…¨éƒ¨æ³¢æ¬¡å®Œæˆ â†’ state.Phase = Completed
```

### 6.3 æ€ªç‰©ç­›é€‰é€»è¾‘

```csharp
/// <summary>
/// æ ¹æ®ç­›é€‰æ ‡ç­¾ä»æ€ªç‰©æ± ä¸­è·å–å€™é€‰æ€ªç‰©ã€‚
/// </summary>
private MonsterInfo[] FilterMonsters(MonsterInfo[] pool, string filter)
{
    // ç©ºç­›é€‰æˆ– "All" â†’ è¿”å›å…¨éƒ¨æ€ªç‰©æ± 
    if (string.IsNullOrEmpty(filter) || filter == "All")
        return pool;

    // æŒ‰æ ‡ç­¾ç­›é€‰
    return pool.Where(m => m.tag == filter).ToArray();
}
```

### 6.4 æƒé‡éšæœºæŠ½å–é€»è¾‘

```csharp
/// <summary>
/// æŒ‰æƒé‡ä»å€™é€‰æ€ªç‰©ä¸­éšæœºæŠ½å– count ä¸ªã€‚
/// åŒä¸€ä¸ªæ€ªç‰©å¯ä»¥è¢«å¤šæ¬¡æŠ½ä¸­ï¼ˆæœ‰æ”¾å›æŠ½æ ·ï¼‰ã€‚
/// </summary>
private MonsterInfo[] WeightedSample(MonsterInfo[] candidates, int count)
{
    // è®¡ç®—æ€»æƒé‡
    int totalWeight = candidates.Sum(c => c.weight);

    var result = new MonsterInfo[count];
    for (int i = 0; i < count; i++)
    {
        int roll = Random.Range(0, totalWeight);
        int cumulative = 0;
        for (int j = 0; j < candidates.Length; j++)
        {
            cumulative += candidates[j].weight;
            if (roll < cumulative)
            {
                result[i] = candidates[j];
                break;
            }
        }
    }
    return result;
}
```

### 6.5 onWaveStart ç«¯å£äº‹ä»¶

```csharp
// åœ¨åˆ·æ€ªå‰è§¦å‘ onWaveStart ç«¯å£
// TransitionSystem ä¼šåœ¨ä¸‹ä¸€é˜¶æ®µå¤„ç†è¿™ä¸ªäº‹ä»¶
private void EmitWaveStartEvent(BlueprintFrame frame, int actionIndex, int waveIndex)
{
    // å°†å½“å‰æ³¢æ¬¡ç´¢å¼•å†™å…¥ä¸´æ—¶å±æ€§ï¼Œä¾›ä¸‹æ¸¸èŠ‚ç‚¹è¯»å–
    frame.SetProperty(actionIndex, "currentWaveIndex", waveIndex.ToString());

    // æŸ¥æ‰¾ onWaveStart ç«¯å£çš„å‡ºè¾¹ï¼Œç”Ÿæˆ PortEvent
    var transitionIndices = frame.GetOutgoingTransitionIndices(actionIndex);
    for (int t = 0; t < transitionIndices.Count; t++)
    {
        var transition = frame.Transitions[transitionIndices[t]];
        if (transition.FromPortId == "onWaveStart")
        {
            var toIndex = frame.GetActionIndex(transition.ToActionId);
            if (toIndex >= 0)
            {
                frame.PendingEvents.Add(new PortEvent(
                    actionIndex, "onWaveStart", toIndex, transition.ToPortId));
            }
        }
    }
}
```

**å…³é”®è®¾è®¡**ï¼š
- `onWaveStart` äº‹ä»¶ä¸é˜»å¡åˆ·æ€ªâ€”â€”å…ˆè§¦å‘äº‹ä»¶ï¼Œå†ç”Ÿæˆæ€ªç‰©
- ä¸‹æ¸¸èŠ‚ç‚¹é€šè¿‡è¯»å– `currentWaveIndex` å±æ€§åˆ¤æ–­å½“å‰æ³¢æ¬¡
- å¦‚æœ `onWaveStart` æ²¡æœ‰è¿æ¥ä¸‹æ¸¸èŠ‚ç‚¹ï¼Œä¸äº§ç”Ÿä»»ä½•äº‹ä»¶

---

## ä¸ƒã€Blueprint ç»„åˆç¤ºä¾‹

### 7.1 ç®€å• 3 æ³¢åˆ·æ€ªï¼ˆæœ€å¸¸è§åœºæ™¯ï¼‰

**ç­–åˆ’é…ç½®æ­¥éª¤**ï¼š
1. SceneViewï¼šç”» AreaMarker â†’ æ·»åŠ  WaveSpawnConfig â†’ é…ç½®æ€ªç‰©æ± ï¼ˆå…¨éƒ¨æ ‡è®°ä¸º Normalï¼‰
2. Blueprintï¼šåˆ›å»º Spawn.Wave èŠ‚ç‚¹ â†’ ç»‘å®š AreaMarker â†’ é…ç½® 3 ä¸ªæ³¢æ¬¡

```
SceneView:
  AreaMarker "èµ°å»Šåˆ·æ€ªåŒº"
    â””â”€ WaveSpawnConfig
        â”œâ”€ éª·é«…æˆ˜å£« Lv.3 (Normal, weight:50)
        â””â”€ éª·é«…å¼“æ‰‹ Lv.3 (Normal, weight:50)

Blueprint:
  [Trigger.EnterArea] â”€â”€â†’ [Spawn.Wave] â”€â”€outâ”€â”€â†’ [Flow.End]
                              â”‚
                              â””â”€ spawnArea: èµ°å»Šåˆ·æ€ªåŒº
                              â””â”€ waves:
                                  â”œâ”€ æ³¢æ¬¡1: 5ä¸ª, 0 Tick, All
                                  â”œâ”€ æ³¢æ¬¡2: 5ä¸ª, 60 Tick, All
                                  â””â”€ æ³¢æ¬¡3: 8ä¸ª, 60 Tick, All
```

**é…ç½®æ—¶é—´**ï¼šçº¦ 3 åˆ†é’Ÿ

### 7.2 å˜é€Ÿåˆ·æ€ª + Boss æ”¶å°¾

```
SceneView:
  AreaMarker "Bossæˆ¿é—´åˆ·æ€ªåŒº"
    â””â”€ WaveSpawnConfig
        â”œâ”€ å°é¬¼ Lv.5 (Normal, weight:60)
        â”œâ”€ ç²¾è‹±å°é¬¼ Lv.8 (Elite, weight:40)
        â””â”€ é¬¼ç‹ Lv.15 (Boss, weight:100)

Blueprint:
  [Trigger.EnterArea] â”€â”€â†’ [Spawn.Wave] â”€â”€outâ”€â”€â†’ [Flow.End]
                              â”‚
                              â””â”€ waves:
                                  â”œâ”€ æ³¢æ¬¡1: 5ä¸ª, 0 Tick, Normal     (ç«‹å³å¼€å§‹)
                                  â”œâ”€ æ³¢æ¬¡2: 8ä¸ª, 60 Tick, Normal    (6ç§’åï¼ŒåŠ é‡)
                                  â”œâ”€ æ³¢æ¬¡3: 3ä¸ª, 45 Tick, Elite     (4.5ç§’åï¼Œç²¾è‹±æ³¢)
                                  â”œâ”€ æ³¢æ¬¡4: 10ä¸ª, 30 Tick, Normal   (3ç§’åï¼ŒåŠ é€Ÿ)
                                  â””â”€ æ³¢æ¬¡5: 1ä¸ª, 90 Tick, Boss      (9ç§’åï¼ŒBossç™»åœº)
```

**é…ç½®æ—¶é—´**ï¼šçº¦ 5 åˆ†é’Ÿ

### 7.3 ç‰¹å®šæ³¢æ¬¡è§¦å‘å±å¹•éœ‡åŠ¨

```
Blueprint:
  [Trigger.EnterArea]
        â†“
  [Spawn.Wave] â”€â”€onWaveStartâ”€â”€â†’ [Flow.Branch]
        â”‚                            â”‚
        â”‚                     condition: waveIndex == 4
        â”‚                            â”‚
        â”‚                     â”Œâ”€â”€Trueâ”€â”˜â”€â”€Falseâ”€â”€â”
        â”‚                     â†“                  â†“
        â”‚              [VFX.CameraShake]    (æ— æ“ä½œ)
        â”‚              [VFX.ShowWarning]
        â”‚                "Boss å³å°†ç™»åœºï¼"
        â”‚
        â””â”€â”€outâ”€â”€â†’ [Flow.End]
```

**è¯­ä¹‰**ï¼šç¬¬ 5 æ³¢ï¼ˆBoss æ³¢ï¼‰å¼€å§‹å‰ï¼Œå±å¹•éœ‡åŠ¨ + æ˜¾ç¤ºè­¦å‘Šæ–‡å­—

### 7.4 å¹¶è¡Œåˆ·æ€ª + æ±‡èš

```
Blueprint:
  [Flow.Start] â”€â”€â†’ [Spawn.Wave: å·¦è·¯] â”€â”€â”
                                         â”œâ”€â”€â†’ [Flow.Join] â”€â”€â†’ [Boss.Spawn]
  [Flow.Start] â”€â”€â†’ [Spawn.Wave: å³è·¯] â”€â”€â”˜
```

**è¯­ä¹‰**ï¼šå·¦å³ä¸¤è·¯åŒæ—¶åˆ·æ€ªï¼Œå…¨éƒ¨å®Œæˆååˆ· Bossã€‚åˆ©ç”¨å·²æœ‰çš„ Flow.Join èŠ‚ç‚¹å®ç° AND æ±‡èšã€‚

---

## å…«ã€å¯¼å‡ºæ•°æ®æ ¼å¼

### 8.1 WaveSpawnConfig å¯¼å‡ºæ•°æ®

é‡æ„åï¼ŒWaveSpawnConfig åªå¯¼å‡ºæ€ªç‰©æ± å’Œç©ºé—´è®¾ç½®ï¼š

```json
{
    "TypeId": "WaveSpawn",
    "Properties": [
        {
            "Key": "monsters",
            "Value": "{\"items\":[{\"monsterId\":\"skeleton_warrior\",\"level\":3,\"behavior\":\"Patrol\",\"guardRadius\":5,\"tag\":\"Normal\",\"weight\":50},{\"monsterId\":\"skeleton_king\",\"level\":10,\"behavior\":\"Idle\",\"guardRadius\":0.5,\"tag\":\"Boss\",\"weight\":100}]}"
        },
        {
            "Key": "minSpacing",
            "Value": "1.5"
        }
    ]
}
```

### 8.2 Spawn.Wave èŠ‚ç‚¹å¯¼å‡ºæ•°æ®

æ³¢æ¬¡é…ç½®ä½œä¸ºèŠ‚ç‚¹å±æ€§å¯¼å‡ºï¼š

```json
{
    "Id": "wave_action_01",
    "TypeId": "Spawn.Wave",
    "Properties": [
        {
            "Key": "waves",
            "ValueType": "json",
            "Value": "[{\"count\":5,\"intervalTicks\":0,\"monsterFilter\":\"Normal\"},{\"count\":5,\"intervalTicks\":60,\"monsterFilter\":\"Normal\"},{\"count\":1,\"intervalTicks\":90,\"monsterFilter\":\"Boss\"}]"
        }
    ],
    "SceneBindings": [
        {
            "BindingKey": "spawnArea",
            "BindingType": "Area",
            "SpatialPayloadJson": "{\"center\":{\"x\":53.7,\"y\":18.0,\"z\":27.8},\"size\":{\"x\":8,\"y\":3,\"z\":8},\"rotation\":{\"x\":0,\"y\":0,\"z\":0},\"shape\":\"Box\"}",
            "Annotations": [
                {
                    "TypeId": "WaveSpawn",
                    "Properties": [
                        { "Key": "monsters", "Value": "..." },
                        { "Key": "minSpacing", "Value": "1.5" }
                    ]
                }
            ]
        }
    ]
}
```

### 8.3 è¿è¡Œæ—¶æ•°æ®è§£æ

SpawnWaveSystem éœ€è¦è§£æä¸¤éƒ¨åˆ†æ•°æ®ï¼š

1. **ä» SceneBinding.Annotations ä¸­**ï¼šè§£ææ€ªç‰©æ± ï¼ˆmonstersï¼‰å’Œç©ºé—´è®¾ç½®ï¼ˆminSpacingï¼‰
2. **ä» Properties["waves"] ä¸­**ï¼šè§£ææ³¢æ¬¡é…ç½®åˆ—è¡¨

```csharp
// è§£ææ³¢æ¬¡é…ç½®
private WaveEntry[] ParseWaveEntries(BlueprintFrame frame, int actionIndex)
{
    var wavesJson = frame.GetProperty(actionIndex, "waves");
    if (string.IsNullOrEmpty(wavesJson))
    {
        // å…œåº•ï¼šå¦‚æœæ²¡æœ‰æ³¢æ¬¡é…ç½®ï¼Œç”Ÿæˆé»˜è®¤çš„å•æ³¢æ¬¡
        return new[] { new WaveEntry { count = 5, intervalTicks = 0, monsterFilter = "All" } };
    }
    return JsonUtility.FromJson<WaveEntryListWrapper>(wavesJson).items;
}
```

---

## ä¹ã€è¿ç§»æ–¹æ¡ˆ

### 9.1 å½±å“èŒƒå›´

| æ–‡ä»¶ | å˜æ›´ç±»å‹ | è¯´æ˜ |
|------|---------|------|
| `WaveSpawnConfig.cs` | ä¿®æ”¹ | ç§»é™¤ WaveCount/WaveIntervalTicks/countï¼Œæ–°å¢ tag/weight |
| `SpawnWaveDef.cs` | ä¿®æ”¹ | æ–°å¢ waves å±æ€§ã€onWaveStart ç«¯å£ |
| `SpawnWaveSystem.cs` | é‡å†™ | æ–°å¢æ³¢æ¬¡é…ç½®è§£æã€æ€ªç‰©ç­›é€‰ã€æƒé‡æŠ½å–ã€ç«¯å£äº‹ä»¶ |
| `BlueprintExporter.cs` | å°æ”¹ | ç¡®ä¿ waves å±æ€§æ­£ç¡®å¯¼å‡º |
| ç°æœ‰è“å›¾ JSON | éœ€é‡æ–°å¯¼å‡º | æ—§æ ¼å¼ä¸å…¼å®¹ |
| ç°æœ‰åœºæ™¯ä¸­çš„ WaveSpawnConfig | éœ€æ‰‹åŠ¨è°ƒæ•´ | ç§»é™¤çš„å­—æ®µä¼šä¸¢å¤± |

### 9.2 è¿ç§»æ­¥éª¤

```
ç¬¬ 1 æ­¥ï¼šå¤‡ä»½
  â†’ git commit å½“å‰çŠ¶æ€

ç¬¬ 2 æ­¥ï¼šä¿®æ”¹ WaveSpawnConfig
  â†’ ç§»é™¤ WaveCountã€WaveIntervalTicksã€MonsterEntry.count
  â†’ æ–°å¢ MonsterEntry.tagã€MonsterEntry.weightã€MonsterTag æšä¸¾
  â†’ æ›´æ–° CollectExportData
  â†’ æ›´æ–° Gizmo æ˜¾ç¤º

ç¬¬ 3 æ­¥ï¼šä¿®æ”¹ SpawnWaveDef
  â†’ æ–°å¢ waves å±æ€§å®šä¹‰
  â†’ æ–°å¢ onWaveStart ç«¯å£
  â†’ æ–°å¢ WaveEntry æ•°æ®ç»“æ„

ç¬¬ 4 æ­¥ï¼šé‡å†™ SpawnWaveSystem
  â†’ æ–°å¢æ³¢æ¬¡é…ç½®è§£æé€»è¾‘
  â†’ æ–°å¢æ€ªç‰©ç­›é€‰é€»è¾‘
  â†’ æ–°å¢æƒé‡éšæœºæŠ½å–é€»è¾‘
  â†’ æ–°å¢ onWaveStart ç«¯å£äº‹ä»¶è§¦å‘
  â†’ ä¿ç•™ç°æœ‰çš„åŒºåŸŸéšæœºä½ç½®ç”Ÿæˆé€»è¾‘

ç¬¬ 5 æ­¥ï¼šæ›´æ–°å¯¼å‡ºå™¨
  â†’ ç¡®ä¿ waves å±æ€§æ­£ç¡®åºåˆ—åŒ–
  â†’ ç¡®ä¿ WaveSpawnConfig æ–°å­—æ®µæ­£ç¡®å¯¼å‡º

ç¬¬ 6 æ­¥ï¼šæ›´æ–°ç°æœ‰åœºæ™¯
  â†’ æ‰‹åŠ¨ä¸º WaveSpawnConfig ä¸­çš„æ€ªç‰©æ·»åŠ  tag å’Œ weight
  â†’ åœ¨ Blueprint ä¸­ä¸º Spawn.Wave èŠ‚ç‚¹é…ç½® waves å±æ€§

ç¬¬ 7 æ­¥ï¼šé‡æ–°å¯¼å‡ºæ‰€æœ‰è“å›¾ JSON

ç¬¬ 8 æ­¥ï¼šæµ‹è¯•éªŒè¯
```

### 9.3 å‘åå…¼å®¹

ç”±äºä¹‹å‰å·²ç¡®è®¤"ä¸éœ€è¦å…¼å®¹æ—§æ•°æ®ï¼Œç›´æ¥é‡æ„"ï¼Œæœ¬æ¬¡é‡æ„ä¸æä¾›æ—§æ ¼å¼å…¼å®¹å±‚ã€‚

è¿è¡Œæ—¶ SpawnWaveSystem åœ¨è§£ææ—¶æä¾›åˆç†çš„å…œåº•ï¼š
- å¦‚æœ `Properties["waves"]` ä¸å­˜åœ¨ â†’ ç”Ÿæˆé»˜è®¤å•æ³¢æ¬¡é…ç½®
- å¦‚æœæ€ªç‰©æ± ä¸­æ²¡æœ‰åŒ¹é…ç­›é€‰æ ‡ç­¾çš„æ€ªç‰© â†’ å›é€€åˆ°å…¨éƒ¨æ€ªç‰©æ± å¹¶æ‰“å°è­¦å‘Š

---

## åã€å®æ–½è·¯çº¿

### Phase 1ï¼šWaveSpawnConfig é‡æ„

```
ç›®æ ‡ï¼šç®€åŒ– WaveSpawnConfigï¼Œåªä¿ç•™æ€ªç‰©æ± å’Œç©ºé—´è®¾ç½®

æ­¥éª¤ï¼š
  1. ä¿®æ”¹ MonsterEntryï¼šç§»é™¤ countï¼Œæ–°å¢ tagï¼ˆMonsterTag æšä¸¾ï¼‰å’Œ weight
  2. ç§»é™¤ WaveCountã€WaveIntervalTicks å­—æ®µ
  3. æ›´æ–° CollectExportDataï¼šå¯¼å‡ºæ–°å­—æ®µ
  4. æ›´æ–° Gizmo æ˜¾ç¤ºï¼šæ˜¾ç¤ºæ€ªç‰©æ± æ¦‚è¦ï¼ˆæŒ‰æ ‡ç­¾åˆ†ç±»ç»Ÿè®¡ï¼‰

éªŒæ”¶ï¼š
  - WaveSpawnConfig Inspector ä¸­åªæ˜¾ç¤ºæ€ªç‰©æ± å’Œç©ºé—´è®¾ç½®
  - Gizmo æ˜¾ç¤º"æ€ªç‰©æ±  (æ™®é€šx2, ç²¾è‹±x1, Bossx1)"
```

### Phase 2ï¼šSpawn.Wave èŠ‚ç‚¹é‡æ„

```
ç›®æ ‡ï¼šæ–°å¢æ³¢æ¬¡é…ç½®å±æ€§å’Œ onWaveStart ç«¯å£

æ­¥éª¤ï¼š
  1. æ–°å¢ WaveEntry æ•°æ®ç»“æ„
  2. ä¿®æ”¹ SpawnWaveDefï¼šæ–°å¢ waves å±æ€§ã€onWaveStart ç«¯å£
  3. ç¡®ä¿å¯¼å‡ºå™¨æ­£ç¡®åºåˆ—åŒ– waves å±æ€§

éªŒæ”¶ï¼š
  - Blueprint ç¼–è¾‘å™¨ä¸­ Spawn.Wave èŠ‚ç‚¹æ˜¾ç¤º waves å±æ€§å’Œ onWaveStart ç«¯å£
  - å¯¼å‡º JSON ä¸­åŒ…å« waves å±æ€§æ•°æ®
```

### Phase 3ï¼šSpawnWaveSystem é‡å†™

```
ç›®æ ‡ï¼šå®ç°æ–°çš„æ³¢æ¬¡æ‰§è¡Œé€»è¾‘

æ­¥éª¤ï¼š
  1. æ–°å¢æ³¢æ¬¡é…ç½®è§£æï¼ˆä» Properties["waves"] è¯»å– WaveEntry[]ï¼‰
  2. æ–°å¢æ€ªç‰©ç­›é€‰é€»è¾‘ï¼ˆæŒ‰ monsterFilter æ ‡ç­¾ç­›é€‰ï¼‰
  3. æ–°å¢æƒé‡éšæœºæŠ½å–é€»è¾‘ï¼ˆæŒ‰ weight åŠ æƒéšæœºï¼‰
  4. æ–°å¢ onWaveStart ç«¯å£äº‹ä»¶è§¦å‘
  5. ä¿ç•™ç°æœ‰çš„åŒºåŸŸéšæœºä½ç½®ç”Ÿæˆé€»è¾‘ï¼ˆGenerateRandomPositionsï¼‰
  6. æ·»åŠ è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—

éªŒæ”¶ï¼š
  - 3 æ³¢æ™®é€šæ€ª + 1 æ³¢ Boss çš„åœºæ™¯æ­£ç¡®æ‰§è¡Œ
  - æ¯æ³¢æ•°é‡ã€é—´éš”ã€æ€ªç‰©ç±»å‹ç¬¦åˆé…ç½®
  - onWaveStart ç«¯å£åœ¨æ¯æ³¢å¼€å§‹æ—¶æ­£ç¡®è§¦å‘
  - æ—¥å¿—è¾“å‡ºæ¸…æ™°å¯è¯»
```

### Phase 4ï¼šæµ‹è¯•ä¸éªŒè¯

```
ç›®æ ‡ï¼šç«¯åˆ°ç«¯éªŒè¯é‡æ„åçš„ç³»ç»Ÿ

æ­¥éª¤ï¼š
  1. æ›´æ–°ç°æœ‰æµ‹è¯•åœºæ™¯çš„ WaveSpawnConfigï¼ˆæ·»åŠ  tag/weightï¼‰
  2. åœ¨ Blueprint ä¸­é…ç½®æ³¢æ¬¡åˆ—è¡¨
  3. é‡æ–°å¯¼å‡ºè“å›¾ JSON
  4. åœ¨æµ‹è¯•çª—å£ä¸­è¿è¡Œï¼ŒéªŒè¯ï¼š
     - æ³¢æ¬¡æ•°é‡æ­£ç¡®
     - æ¯æ³¢é—´éš”æ­£ç¡®
     - æ€ªç‰©ç­›é€‰æ­£ç¡®
     - onWaveStart äº‹ä»¶æ­£ç¡®è§¦å‘
  5. æ›´æ–°å•å…ƒæµ‹è¯•

éªŒæ”¶ï¼š
  - æ‰€æœ‰æµ‹è¯•é€šè¿‡
  - æ—¥å¿—è¾“å‡ºç¬¦åˆé¢„æœŸ
```

---

## åä¸€ã€è®¾è®¡å†³ç­–è®°å½•

| # | é—®é¢˜ | å†³ç­– | ç†ç”± |
|---|------|------|------|
| W1 | æ³¢æ¬¡é€»è¾‘æ”¾åœ¨å“ªä¸€å±‚ï¼Ÿ | Blueprint å±‚ï¼ˆSpawn.Wave èŠ‚ç‚¹å±æ€§ï¼‰ | æ³¢æ¬¡æ•°é‡/é—´éš”/ç­›é€‰æ˜¯è¿è¡Œæ—¶é€»è¾‘ï¼Œä¸æ˜¯ç©ºé—´æ ‡æ³¨ |
| W2 | æ€ªç‰©ç­›é€‰ç”¨ä»€ä¹ˆæœºåˆ¶ï¼Ÿ | æšä¸¾æ ‡ç­¾ï¼ˆMonsterTagï¼‰ | ç®€å•ç›´è§‚ï¼Œç­–åˆ’ä¸éœ€è¦å†™è¡¨è¾¾å¼ï¼›æšä¸¾å€¼æœ‰é™å¯æ§ |
| W3 | æ¯æ³¢æ€ªç‰©æ•°é‡å¦‚ä½•ç¡®å®šï¼Ÿ | ç”± WaveEntry.count æŒ‡å®šï¼Œä»ç­›é€‰åçš„æ€ªç‰©æ± ä¸­æŒ‰æƒé‡éšæœºæŠ½å– | ç­–åˆ’æ§åˆ¶æ¯æ³¢æ•°é‡ï¼Œæƒé‡æ§åˆ¶æ€ªç‰©åˆ†å¸ƒ |
| W4 | onWaveStart æ˜¯å¦é˜»å¡åˆ·æ€ªï¼Ÿ | ä¸é˜»å¡ï¼Œå…ˆè§¦å‘äº‹ä»¶å†ç”Ÿæˆæ€ªç‰© | é¿å…äº‹ä»¶å¤„ç†å»¶è¿Ÿå½±å“åˆ·æ€ªèŠ‚å¥ |
| W5 | æ—§æ•°æ®æ˜¯å¦å…¼å®¹ï¼Ÿ | ä¸å…¼å®¹ï¼Œéœ€è¦é‡æ–°é…ç½®å’Œå¯¼å‡º | ä¹‹å‰å·²ç¡®è®¤ä¸éœ€è¦å…¼å®¹æ—§æ•°æ® |
| W6 | æ˜¯å¦éœ€è¦è‡ªå®šä¹‰ Inspectorï¼Ÿ | æš‚ä¸éœ€è¦ï¼Œä½¿ç”¨ Unity é»˜è®¤ Inspector | é™ä½å®ç°å¤æ‚åº¦ï¼Œåç»­æŒ‰éœ€æ·»åŠ  |
| W7 | MonsterTag ç”¨æšä¸¾è¿˜æ˜¯å­—ç¬¦ä¸²ï¼Ÿ | æšä¸¾ | é˜²æ­¢æ‹¼å†™é”™è¯¯ï¼ŒInspector ä¸‹æ‹‰é€‰æ‹©æ›´å‹å¥½ |
| W8 | æƒé‡æŠ½å–æ˜¯æœ‰æ”¾å›è¿˜æ˜¯æ— æ”¾å›ï¼Ÿ | æœ‰æ”¾å›ï¼ˆåŒä¸€æ€ªç‰©å¯è¢«å¤šæ¬¡æŠ½ä¸­ï¼‰ | ç®€å•ä¸”ç¬¦åˆ"æƒé‡ = å‡ºç°æ¦‚ç‡"çš„ç›´è§‰ |

---

## é™„å½•

### æœ¯è¯­è¡¨

| æœ¯è¯­ | å®šä¹‰ |
|-----|------|
| **æ€ªç‰©æ± ** | WaveSpawnConfig ä¸­é…ç½®çš„æ€ªç‰©åˆ—è¡¨ï¼Œæè¿°"è¿™ä¸ªåŒºåŸŸèƒ½åˆ·ä»€ä¹ˆæ€ª" |
| **æ³¢æ¬¡é…ç½®** | Spawn.Wave èŠ‚ç‚¹ä¸­çš„ WaveEntry åˆ—è¡¨ï¼Œæè¿°"æ¯æ³¢åˆ·å‡ ä¸ªã€é—´éš”å¤šä¹…ã€ç­›é€‰ä»€ä¹ˆæ€ª" |
| **æ€ªç‰©ç­›é€‰** | æ ¹æ® MonsterTag æ ‡ç­¾ä»æ€ªç‰©æ± ä¸­ç­›é€‰å€™é€‰æ€ªç‰© |
| **æƒé‡æŠ½å–** | æŒ‰ weight å­—æ®µåŠ æƒéšæœºä»å€™é€‰æ€ªç‰©ä¸­æŠ½å–æŒ‡å®šæ•°é‡ |
| **onWaveStart** | Spawn.Wave èŠ‚ç‚¹çš„è¾“å‡ºç«¯å£ï¼Œæ¯æ³¢å¼€å§‹æ—¶è§¦å‘ï¼Œç”¨äºè¿æ¥äº‹ä»¶èŠ‚ç‚¹ |

### ç›¸å…³æ–‡æ¡£

- [SceneBlueprintæ ¸å¿ƒè®¾è®¡åŸåˆ™](SceneBlueprintæ ¸å¿ƒè®¾è®¡åŸåˆ™.md) - èŒè´£åˆ†ç¦»åŸåˆ™
- [æ ‡è®°æ ‡æ³¨ç³»ç»Ÿè®¾è®¡](æ ‡è®°æ ‡æ³¨ç³»ç»Ÿè®¾è®¡.md) - MarkerAnnotation åŸºç±»å’Œå¯¼å‡ºæœºåˆ¶
- [èŠ‚ç‚¹æ¿€æ´»è¯­ä¹‰ä¸æ±‡èšè®¾è®¡](èŠ‚ç‚¹æ¿€æ´»è¯­ä¹‰ä¸æ±‡èšè®¾è®¡.md) - èŠ‚ç‚¹ç«¯å£å’Œæ¿€æ´»è§„åˆ™
- [æ•°æ®å¯¼å‡ºä¸è¿è¡Œæ—¶å¥‘çº¦](æ•°æ®å¯¼å‡ºä¸è¿è¡Œæ—¶å¥‘çº¦.md) - å¯¼å‡ºæ•°æ®æ ¼å¼

---

**ç‰ˆæœ¬å†å²**ï¼š

- **v1.0** (2026-02-19)
  - åˆå§‹ç‰ˆæœ¬
  - åˆ†æç°æœ‰ WaveSpawnConfig çš„é—®é¢˜ï¼ˆè¯­ä¹‰ä¸æ˜ç¡®ã€èŒè´£è¾¹ç•Œæ¨¡ç³Šã€çµæ´»æ€§ä¸è¶³ï¼‰
  - ç¡®å®šèŒè´£æ‹†åˆ†æ–¹æ¡ˆï¼šWaveSpawnConfig åªç®¡æ€ªç‰©æ± ï¼ŒSpawn.Wave èŠ‚ç‚¹ç®¡æ³¢æ¬¡é€»è¾‘
  - è®¾è®¡ WaveSpawnConfig é‡æ„ï¼ˆæ–°å¢ tag/weightï¼Œç§»é™¤ WaveCount/WaveIntervalTicks/countï¼‰
  - è®¾è®¡ Spawn.Wave èŠ‚ç‚¹é‡æ„ï¼ˆæ–°å¢ waves å±æ€§ã€onWaveStart ç«¯å£ï¼‰
  - è®¾è®¡ SpawnWaveSystem é‡å†™ï¼ˆæ€ªç‰©ç­›é€‰ã€æƒé‡æŠ½å–ã€ç«¯å£äº‹ä»¶ï¼‰
  - æä¾› Blueprint ç»„åˆç¤ºä¾‹ï¼ˆç®€å•åˆ·æ€ªã€å˜é€Ÿ+Bossã€äº‹ä»¶è§¦å‘ã€å¹¶è¡Œæ±‡èšï¼‰
  - å®šä¹‰å¯¼å‡ºæ•°æ®æ ¼å¼å’Œè¿ç§»æ–¹æ¡ˆ
