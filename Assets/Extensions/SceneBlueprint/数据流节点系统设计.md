# SceneBlueprint æ•°æ®æµèŠ‚ç‚¹ç³»ç»Ÿè®¾è®¡

**ç‰ˆæœ¬**: v1.1  
**æ—¥æœŸ**: 2026-02-17  
**çŠ¶æ€**: âœ… Phase 1-5 å·²å®Œæˆï¼ˆå«é¢„è§ˆæ€§èƒ½ä¼˜åŒ–ï¼‰  
**doc_status**: active  
**last_reviewed**: 2026-02-17

> **ğŸ“– ç›¸å…³æ–‡æ¡£**ï¼šè¯·å…ˆé˜…è¯» [SceneBlueprintæ ¸å¿ƒè®¾è®¡åŸåˆ™.md](./SceneBlueprintæ ¸å¿ƒè®¾è®¡åŸåˆ™.md) äº†è§£æ•´ä½“è®¾è®¡ç†å¿µ  
> æœ¬æ–‡æ¡£ä¸“æ³¨äºæ•°æ®æµèŠ‚ç‚¹ç³»ç»Ÿçš„æŠ€æœ¯å®ç°ç»†èŠ‚

---

## ä¸€ã€è®¾è®¡ç›®æ ‡

### 1.1 æ ¸å¿ƒç†å¿µ

**SceneBlueprint = å£°æ˜å¼é…ç½®å·¥å…·**
- ç”¨èŠ‚ç‚¹å›¾æè¿°"åœ¨ä»€ä¹ˆæ¡ä»¶ä¸‹ï¼Œåšä»€ä¹ˆäº‹"
- å¯¼å‡ºä¸º Playbookï¼ˆJSON é…ç½®ï¼‰
- è¿è¡Œæ—¶ System è¯»å–é…ç½®å¹¶æ‰§è¡Œå…·ä½“é€»è¾‘

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®æµï¼Ÿ

**é—®é¢˜**ï¼šå½“å‰çº¯æ§åˆ¶æµè®¾è®¡çš„å±€é™æ€§
```
[Spawn.Wave]
  â”œâ”€ locationStrategy: RandomArea  âŒ é…ç½®è€¦åˆ
  â”œâ”€ rhythmStrategy: Waves         âŒ éš¾ä»¥å¤ç”¨
  â”œâ”€ monsters: [...]               âŒ èŠ‚ç‚¹è‡ƒè‚¿
  â””â”€ effects: [...]                âŒ ç‰¹æ•ˆè€¦åˆ
```

**è§£å†³æ–¹æ¡ˆ**ï¼šèŠ‚ç‚¹ç»„åˆ + æ•°æ®æµ
```
[Location.RandomArea] â”€â”€positionsâ”€â”€â”
[Monster.Pool]       â”€â”€monstersâ”€â”€â”€â”¼â†’ [Spawn.Execute] â”€â”€â†’ [VFX.ScreenFlash]
[Rhythm.Waves]       â”€â”€rhythmâ”€â”€â”€â”€â”€â”˜
```

**æ”¶ç›Š**ï¼š
- âœ… èŠ‚ç‚¹èŒè´£å•ä¸€
- âœ… ç­–ç•¥å¯å¤ç”¨ï¼ˆLocation å¯ç”¨äºåˆ·æ€ªã€é“å…·ç”Ÿæˆã€NPC æ”¾ç½®ï¼‰
- âœ… ç‰¹æ•ˆç‹¬ç«‹ï¼ˆå¯ä»»æ„ç»„åˆï¼‰
- âœ… è“å›¾å¯è§†åŒ–æ¸…æ™°

---

## äºŒã€ç«¯å£ç³»ç»Ÿæ‰©å±•

### 2.1 ç«¯å£ç±»å‹ï¼ˆPortKindï¼‰

```csharp
public enum PortKind
{
    Flow,    // æ§åˆ¶æµï¼šå†³å®šæ‰§è¡Œé¡ºåºï¼ˆé»‘è‰²çº¿ï¼‰
    Event,   // äº‹ä»¶æµï¼šè§¦å‘åç»­èŠ‚ç‚¹ï¼ˆæ©™è‰²çº¿ï¼‰
    Data     // æ•°æ®æµï¼šä¼ é€’é…ç½®æˆ–çŠ¶æ€ï¼ˆè“è‰²çº¿ï¼‰
}
```

**åŒºåˆ«**ï¼š
- **Flow**ï¼šåŒæ­¥æ‰§è¡Œï¼Œä¸€è¿›ä¸€å‡º
- **Event**ï¼šå¼‚æ­¥è§¦å‘ï¼Œå¯ä»¥å¤šæ¬¡è§¦å‘
- **Data**ï¼šä¸å½±å“æ‰§è¡Œï¼Œåªæä¾›æ•°æ®

### 2.2 ç«¯å£æ–¹å‘ï¼ˆPortDirectionï¼‰

```csharp
public enum PortDirection
{
    Input,   // è¾“å…¥ç«¯å£
    Output   // è¾“å‡ºç«¯å£
}
```

### 2.3 æ•°æ®ç±»å‹å£°æ˜

```csharp
public class PortDefinition
{
    public string Id;                // ç«¯å£ ID
    public string DisplayName;       // æ˜¾ç¤ºåç§°
    public PortKind Kind;            // ç«¯å£ç±»å‹
    public PortDirection Direction;  // æ–¹å‘
    
    // æ•°æ®ç«¯å£ä¸“ç”¨
    public string DataType;          // æ•°æ®ç±»å‹ï¼ˆå¦‚ "Vector3[]"ï¼‰
    public bool Required;            // æ˜¯å¦å¿…éœ€ï¼ˆé»˜è®¤ falseï¼‰
    public string Description;       // æè¿°æ–‡æœ¬
}
```

### 2.4 é¢„å®šä¹‰æ•°æ®ç±»å‹

```csharp
public static class DataTypes
{
    // åŸºç¡€ç±»å‹
    public const string Float = "float";
    public const string Int = "int";
    public const string Bool = "bool";
    public const string String = "string";
    
    // Unity ç±»å‹
    public const string Vector3 = "Vector3";
    public const string Vector3Array = "Vector3[]";
    public const string Transform = "Transform";
    
    // è‡ªå®šä¹‰ç±»å‹
    public const string EntityRef = "EntityRef";
    public const string EntityRefArray = "EntityRef[]";
    public const string MonsterConfig = "MonsterConfig";
    public const string MonsterConfigArray = "MonsterConfig[]";
    public const string RhythmData = "RhythmData";
    public const string AreaData = "AreaData";
}
```

---

## ä¸‰ã€è¿çº¿éªŒè¯è§„åˆ™

### 3.1 åŸºç¡€è§„åˆ™

| è§„åˆ™ | æè¿° | å¼ºåˆ¶æ€§ |
|------|------|--------|
| **R1** | åŒç±»å‹ç«¯å£æ‰èƒ½è¿æ¥ï¼ˆFlowâ†’Flow, Dataâ†’Dataï¼‰ | âœ… å¼ºåˆ¶ |
| **R2** | æ–¹å‘å¿…é¡»åŒ¹é…ï¼ˆOutput â†’ Inputï¼‰ | âœ… å¼ºåˆ¶ |
| **R3** | Data ç«¯å£å¿…é¡»ç±»å‹å…¼å®¹ | âœ… å¼ºåˆ¶ |
| **R4** | Required çš„ Data è¾“å…¥ç«¯å£å¿…é¡»è¿æ¥ | âš ï¸ è­¦å‘Š |
| **R5** | Flow è¾“å…¥ç«¯å£åªèƒ½è¿ä¸€æ¡çº¿ | âœ… å¼ºåˆ¶ |
| **R6** | Flow/Event è¾“å‡ºç«¯å£å¯ä»¥è¿å¤šæ¡çº¿ | âœ… å…è®¸ |
| **R7** | Data è¾“å…¥ç«¯å£åªèƒ½è¿ä¸€æ¡çº¿ | âœ… å¼ºåˆ¶ |
| **R8** | Data è¾“å‡ºç«¯å£å¯ä»¥è¿å¤šæ¡çº¿ | âœ… å…è®¸ |

### 3.2 ç±»å‹å…¼å®¹æ€§åˆ¤æ–­

```
ç²¾ç¡®åŒ¹é…ï¼š
  Vector3 â†’ Vector3               âœ… å…è®¸

æ•°ç»„ç±»å‹ï¼š
  Vector3[] â†’ Vector3[]           âœ… å…è®¸
  Vector3 â†’ Vector3[]             âŒ ç¦æ­¢ï¼ˆä¸è‡ªåŠ¨åŒ…è£…ï¼‰

å­ç±»å‹ï¼ˆæœªæ¥æ‰©å±•ï¼‰ï¼š
  MonsterConfig â†’ UnitConfig      âœ… å…è®¸ï¼ˆå¦‚æœç»§æ‰¿å…³ç³»æˆç«‹ï¼‰

ç±»å‹ä¸åŒ¹é…ï¼š
  Vector3 â†’ EntityRef             âŒ ç¦æ­¢
  Vector3[] â†’ MonsterConfig[]     âŒ ç¦æ­¢
```

**å®ç°**ï¼š
```csharp
public static bool IsCompatible(string sourceType, string targetType)
{
    return DataTypeRegistry.Instance.IsCompatible(sourceType, targetType);
}
```

**å½“å‰å®ç°è¯´æ˜ï¼ˆ2026-02-17ï¼‰**ï¼š
- ç±»å‹å…¼å®¹æ€§ç”± `DataTypeRegistry` ç»Ÿä¸€æ‰˜ç®¡ï¼Œè€Œéæ•£è½åœ¨å„éªŒè¯ç‚¹ã€‚
- æ”¯æŒæ•°ç»„å…ƒç´ ç±»å‹é€’å½’æ£€æŸ¥ï¼ˆå¦‚ `Vector3[]` ä»…å…¼å®¹ `Vector3[]`ï¼‰ã€‚
- é¢„ç•™å¹¶æ”¯æŒåŸºç±»å‹é“¾çš„å­ç±»å‹æ£€æŸ¥ï¼ˆ`derived -> base`ï¼‰ã€‚

### 3.3 ç¼–è¾‘å™¨äº¤äº’

**æ‹–åŠ¨è¿çº¿æ—¶**ï¼š
1. é«˜äº®æ‰€æœ‰å…¼å®¹çš„ç«¯å£ï¼ˆå‘å…‰æ•ˆæœï¼‰
2. ç°æ˜¾ä¸å…¼å®¹çš„ç«¯å£
3. é¼ æ ‡æ‚¬åœåœ¨ä¸å…¼å®¹ç«¯å£æ—¶ï¼Œæ˜¾ç¤ºé”™è¯¯æç¤º
   ```
   âŒ ç±»å‹ä¸åŒ¹é…
   æºç«¯å£: Vector3[]
   ç›®æ ‡ç«¯å£: MonsterConfig[]
   ```

**è¿çº¿åéªŒè¯**ï¼š
1. æ£€æŸ¥ç±»å‹å…¼å®¹æ€§
2. ä¸å…¼å®¹æ—¶**é˜»æ­¢è¿çº¿**å¹¶å¼¹å‡ºé”™è¯¯æç¤º
3. åœ¨èŠ‚ç‚¹ä¸Šæ˜¾ç¤ºé”™è¯¯æ ‡è®°ï¼ˆçº¢è‰²æ„Ÿå¹å·ï¼‰

**å¿…éœ€æ€§æ£€æŸ¥**ï¼š
1. ä¿å­˜è“å›¾æ—¶æ£€æŸ¥æ‰€æœ‰ `Required = true` çš„ Data è¾“å…¥ç«¯å£
2. æœªè¿æ¥çš„å¿…éœ€ç«¯å£æ˜¾ç¤ºè­¦å‘Šï¼ˆâš ï¸ï¼‰
3. å¯ä»¥ä¿å­˜ï¼Œä½†åœ¨é—®é¢˜é¢æ¿ä¸­åˆ—å‡ºè­¦å‘Š

---

## å››ã€èŠ‚ç‚¹åˆ†ç±»è®¾è®¡

### 4.1 é…ç½®æä¾›èŠ‚ç‚¹ï¼ˆProviderï¼‰

**èŒè´£**ï¼šç”Ÿæˆé™æ€é…ç½®æ•°æ®

**ç‰¹å¾**ï¼š
- æ—  Flow è¾“å…¥ç«¯å£ï¼ˆä¸éœ€è¦è§¦å‘ï¼‰
- åªæœ‰ Data è¾“å‡ºç«¯å£
- ç¼–è¾‘æ—¶å°±èƒ½ç¡®å®šè¾“å‡º

**å…¸å‹èŠ‚ç‚¹**ï¼š

#### Location.RandomArea
```
è¾“å‡ºï¼š
  - positions: Vector3[]

å±æ€§ï¼š
  - area: SceneBinding (Area)
  - count: int (æ•°é‡)
```

#### Location.PresetPoints
```
è¾“å‡ºï¼š
  - positions: Vector3[]

å±æ€§ï¼š
  - points: SceneBinding (Transform)
```

#### Monster.Pool
```
è¾“å‡ºï¼š
  - monsters: MonsterConfig[]

å±æ€§ï¼š
  - configs: MonsterConfig[] (åˆ—è¡¨)
```

#### Rhythm.Waves
```
è¾“å‡ºï¼š
  - rhythm: RhythmData

å±æ€§ï¼š
  - waveCount: int
  - waveInterval: float
```

---

### 4.2 æ‰§è¡ŒèŠ‚ç‚¹ï¼ˆExecutorï¼‰

**èŒè´£**ï¼šæ‰§è¡Œå…·ä½“çš„æ¸¸æˆé€»è¾‘

**ç‰¹å¾**ï¼š
- æœ‰ Flow è¾“å…¥/è¾“å‡ºç«¯å£
- å¯ä»¥æœ‰ Data è¾“å…¥ç«¯å£ï¼ˆæ¥æ”¶é…ç½®ï¼‰
- å¯ä»¥æœ‰ Data è¾“å‡ºç«¯å£ï¼ˆè¾“å‡ºè¿è¡Œæ—¶çŠ¶æ€ï¼‰
- å¯ä»¥æœ‰ Event è¾“å‡ºç«¯å£ï¼ˆè§¦å‘åç»­äº‹ä»¶ï¼‰

**å…¸å‹èŠ‚ç‚¹**ï¼š

#### Spawn.Execute
```
è¾“å…¥ï¼ˆFlowï¼‰ï¼š
  - in: Flow

è¾“å…¥ï¼ˆDataï¼‰ï¼š
  - positions: Vector3[] (Required)
  - monsters: MonsterConfig[] (Required)
  - rhythm: RhythmData (å¯é€‰)

è¾“å‡ºï¼ˆFlowï¼‰ï¼š
  - out: Flow

è¾“å‡ºï¼ˆEventï¼‰ï¼š
  - onWaveComplete: Event (æ¯æ³¢å®Œæˆ)
  - onAllComplete: Event (å…¨éƒ¨å®Œæˆ)

è¾“å‡ºï¼ˆDataï¼‰ï¼š
  - spawnedEntities: EntityRef[]

å±æ€§ï¼š
  - spawnDelay: float (å»¶è¿Ÿ)
```

**è“å›¾ç¤ºä¾‹**ï¼š
```
[Location.RandomArea] â”€â”€positionsâ”€â”€â”
[Monster.Pool]       â”€â”€monstersâ”€â”€â”€â”¼â†’ [Spawn.Execute] â”€outâ†’ [VFX.ScreenFlash]
                                        â”‚
                                        â””â”€onAllCompleteâ†’ [Spawn: Boss]
```

---

### 4.3 æ¡ä»¶èŠ‚ç‚¹ï¼ˆConditionï¼‰

**èŒè´£**ï¼šç›‘å¬è¿è¡Œæ—¶çŠ¶æ€ï¼Œæ¡ä»¶æ»¡è¶³æ—¶è§¦å‘

**ç‰¹å¾**ï¼š
- æœ‰ Flow è¾“å…¥ç«¯å£ï¼ˆå¼€å§‹ç›‘å¬ï¼‰
- æœ‰ Data è¾“å…¥ç«¯å£ï¼ˆç›‘å¬å¯¹è±¡ï¼‰
- æœ‰ Event è¾“å‡ºç«¯å£ï¼ˆæ¡ä»¶æ»¡è¶³æ—¶è§¦å‘ï¼‰
- æ—  Flow è¾“å‡ºç«¯å£ï¼ˆä¸æ˜¯åŒæ­¥æµç¨‹ï¼‰

**å…¸å‹èŠ‚ç‚¹**ï¼š

#### Condition.AllDead
```
è¾“å…¥ï¼ˆFlowï¼‰ï¼š
  - in: Flow (å¼€å§‹ç›‘å¬)

è¾“å…¥ï¼ˆDataï¼‰ï¼š
  - entities: EntityRef[] (Required)

è¾“å‡ºï¼ˆEventï¼‰ï¼š
  - onAllDead: Event

å±æ€§ï¼š
  - checkInterval: float (æ£€æŸ¥é—´éš”)
```

**è“å›¾ç¤ºä¾‹**ï¼š
```
[Spawn.Execute] â”€spawnedEntitiesâ†’ [Condition.AllDead] â”€onAllDeadâ†’ [Spawn: Boss]
                â””â”€outâ†’ [VFX.ScreenFlash]
```

---

### 4.4 ç‰¹æ•ˆèŠ‚ç‚¹ï¼ˆVFXï¼‰

**èŒè´£**ï¼šæ’­æ”¾è§†è§‰/å¬è§‰ç‰¹æ•ˆ

**ç‰¹å¾**ï¼š
- æœ‰ Flow è¾“å…¥/è¾“å‡ºç«¯å£
- å¯ä»¥æœ‰ Data è¾“å…¥ç«¯å£ï¼ˆæ¥æ”¶å‚æ•°ï¼Œå¦‚ä½ç½®ï¼‰
- æ—  Data è¾“å‡ºç«¯å£

**å…¸å‹èŠ‚ç‚¹**ï¼š

#### VFX.ScreenFlash
```
è¾“å…¥ï¼ˆFlowï¼‰ï¼š
  - in: Flow

è¾“å‡ºï¼ˆFlowï¼‰ï¼š
  - out: Flow

å±æ€§ï¼š
  - color: Color
  - duration: float
  - intensity: float
```

#### VFX.CameraShake
```
è¾“å…¥ï¼ˆFlowï¼‰ï¼š
  - in: Flow

è¾“å…¥ï¼ˆDataï¼Œå¯é€‰ï¼‰ï¼š
  - epicenter: Vector3 (éœ‡ä¸­ä½ç½®)

è¾“å‡ºï¼ˆFlowï¼‰ï¼š
  - out: Flow

å±æ€§ï¼š
  - intensity: float
  - duration: float
```

---

### 4.5 è§¦å‘èŠ‚ç‚¹ï¼ˆTriggerï¼‰

**èŒè´£**ï¼šç›‘å¬æ¸¸æˆäº‹ä»¶ï¼Œä½œä¸ºè“å›¾çš„å…¥å£

**ç‰¹å¾**ï¼š
- æ—  Flow è¾“å…¥ç«¯å£ï¼ˆç”±è¿è¡Œæ—¶è§¦å‘ï¼‰
- æœ‰ Flow è¾“å‡ºç«¯å£
- å¯ä»¥æœ‰ Event è¾“å‡ºç«¯å£ï¼ˆé‡å¤è§¦å‘ï¼‰

**å…¸å‹èŠ‚ç‚¹**ï¼š

#### Trigger.EnterArea
```
è¾“å‡ºï¼ˆFlowï¼‰ï¼š
  - out: Flow (é¦–æ¬¡è¿›å…¥)

è¾“å‡ºï¼ˆEventï¼‰ï¼š
  - onReEnter: Event (é‡å¤è¿›å…¥)

å±æ€§ï¼š
  - area: SceneBinding (Area)
  - triggerMode: Enum (Once, Multiple)
```

---

## äº”ã€å…¸å‹è“å›¾åœºæ™¯

### 5.1 ç®€å•åˆ·æ€ª

```
[Trigger.EnterArea] â”€â”€â”
                      â”‚
[Location.RandomArea]â”€â”¼â”€positionsâ”€â”
[Monster.Pool]       â”€â”¼â”€monstersâ”€â”€â”¼â†’ [Spawn.Execute] â”€â”€â†’ [VFX.ScreenFlash]
```

**è¯­ä¹‰**ï¼š
- ç©å®¶è¿›å…¥åŒºåŸŸ
- åœ¨æŒ‡å®šåŒºåŸŸéšæœºä½ç½®
- åˆ·å‡ºé…ç½®çš„æ€ªç‰©
- æ’­æ”¾é—ªå±ç‰¹æ•ˆ

---

### 5.2 æ³¢æ¬¡åˆ·æ€ª + æ¡ä»¶è§¦å‘

```
[Trigger.EnterArea] â”€â”€â”
                      â”‚
[Location.RandomArea]â”€â”¼â”€positionsâ”€â”
[Monster.Pool: å°æ€ª] â”€â”¼â”€monstersâ”€â”€â”¼â†’ [Spawn.Execute: ç¬¬ä¸€æ³¢] â”€â”¬â”€outâ†’ [VFX]
[Rhythm.Waves]       â”€â”¼â”€rhythmâ”€â”€â”€â”€â”˜                           â”‚
                                                               â””â”€spawnedEntitiesâ”€â”
                                                                                 â”‚
                                    [Location.PresetPoints]â”€positionsâ”€â”         â”‚
                                    [Monster.Pool: Boss]   â”€monstersâ”€â”€â”¼â†’ [Spawn.Execute: Boss]
                                                                       â”‚         â”‚
                                    [Condition.AllDead]â†â”€â”€â”€â”€â”€â”€entitiesâ”€â”˜         â”‚
                                           â”‚                                     â”‚
                                           â””â”€onAllDeadâ†’â”€â”€â”€â”€â”€â”€â”€â”€inâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¯­ä¹‰**ï¼š
1. ç©å®¶è¿›å…¥åŒºåŸŸï¼Œè§¦å‘ç¬¬ä¸€æ³¢åˆ·æ€ªï¼ˆå°æ€ªï¼‰
2. ç¬¬ä¸€æ³¢åˆ·æ€ªå®Œæˆåï¼Œæ’­æ”¾ç‰¹æ•ˆ
3. åŒæ—¶ï¼ŒCondition.AllDead å¼€å§‹ç›‘å¬ç¬¬ä¸€æ³¢æ€ªç‰©
4. å½“ç¬¬ä¸€æ³¢æ€ªç‰©å…¨éƒ¨æ­»äº¡æ—¶ï¼Œè§¦å‘ Boss åˆ·æ€ª

---

### 5.3 å¤æ‚ç‰¹æ•ˆç»„åˆ

```
[Spawn.Execute] â”€outâ†’ [VFX.ScreenFlash]
                 â”‚
                 â”œâ”€â†’ [VFX.CameraShake]
                 â”‚
                 â””â”€â†’ [Audio.PlaySFX]
```

**è¯­ä¹‰**ï¼š
- åˆ·æ€ªå®Œæˆåï¼Œå¹¶è¡Œè§¦å‘å¤šä¸ªç‰¹æ•ˆ
- é—ªå± + éœ‡å± + éŸ³æ•ˆ

---

## å…­ã€ç¼–è¾‘å™¨å®ç°è¦ç‚¹

### 6.1 ç«¯å£å®šä¹‰è¯­æ³•ç³–

```csharp
// ä¾¿æ·æ–¹æ³•
public static class Port
{
    public static PortDefinition In(string id, string displayName = null)
        => new PortDefinition
        {
            Id = id,
            DisplayName = displayName ?? id,
            Kind = PortKind.Flow,
            Direction = PortDirection.Input
        };
    
    public static PortDefinition Out(string id, string displayName = null)
        => new PortDefinition
        {
            Id = id,
            DisplayName = displayName ?? id,
            Kind = PortKind.Flow,
            Direction = PortDirection.Output
        };
    
    public static PortDefinition Event(string id, string displayName = null)
        => new PortDefinition
        {
            Id = id,
            DisplayName = displayName ?? id,
            Kind = PortKind.Event,
            Direction = PortDirection.Output
        };
    
    public static PortDefinition DataIn(string id, string displayName, 
        string dataType, bool required = false, string description = null)
        => new PortDefinition
        {
            Id = id,
            DisplayName = displayName,
            Kind = PortKind.Data,
            Direction = PortDirection.Input,
            DataType = dataType,
            Required = required,
            Description = description
        };
    
    public static PortDefinition DataOut(string id, string displayName, 
        string dataType, string description = null)
        => new PortDefinition
        {
            Id = id,
            DisplayName = displayName,
            Kind = PortKind.Data,
            Direction = PortDirection.Output,
            DataType = dataType,
            Description = description
        };
}
```

### 6.2 è¿çº¿éªŒè¯é€»è¾‘

```csharp
public class ConnectionValidator
{
    public ValidationResult ValidateConnection(
        PortDefinition sourcePort, 
        PortDefinition targetPort)
    {
        // R1: åŒç±»å‹ç«¯å£æ‰èƒ½è¿æ¥
        if (sourcePort.Kind != targetPort.Kind)
            return ValidationResult.Error("ç«¯å£ç±»å‹ä¸åŒ¹é…");
        
        // R2: æ–¹å‘å¿…é¡»åŒ¹é…
        if (sourcePort.Direction != PortDirection.Output)
            return ValidationResult.Error("æºç«¯å£å¿…é¡»æ˜¯è¾“å‡ºç«¯å£");
        if (targetPort.Direction != PortDirection.Input)
            return ValidationResult.Error("ç›®æ ‡ç«¯å£å¿…é¡»æ˜¯è¾“å…¥ç«¯å£");
        
        // R3: Data ç«¯å£ç±»å‹å…¼å®¹æ€§
        if (sourcePort.Kind == PortKind.Data)
        {
            if (!IsTypeCompatible(sourcePort.DataType, targetPort.DataType))
                return ValidationResult.Error(
                    $"æ•°æ®ç±»å‹ä¸å…¼å®¹ï¼š{sourcePort.DataType} â†’ {targetPort.DataType}");
        }
        
        return ValidationResult.Success();
    }
    
    public bool IsTypeCompatible(string sourceType, string targetType)
    {
        return DataTypeRegistry.Instance.IsCompatible(sourceType, targetType);
    }
}
```

### 6.3 å¿…éœ€æ€§æ£€æŸ¥

```csharp
public class BlueprintValidator
{
    public IssueReport ValidateBlueprint(SceneBlueprintData blueprint)
    {
        var issues = new List<Issue>();
        
        foreach (var node in blueprint.Nodes)
        {
            var definition = ActionRegistry.Get(node.TypeId);
            
            foreach (var port in definition.Ports)
            {
                // æ£€æŸ¥å¿…éœ€çš„ Data è¾“å…¥ç«¯å£
                if (port.Kind == PortKind.Data 
                    && port.Direction == PortDirection.Input 
                    && port.Required)
                {
                    var isConnected = blueprint.Edges.Any(e => 
                        e.TargetNodeId == node.Id && e.TargetPortId == port.Id);
                    
                    if (!isConnected)
                    {
                        issues.Add(new Issue
                        {
                            Severity = IssueSeverity.Warning,
                            NodeId = node.Id,
                            Message = $"å¿…éœ€çš„æ•°æ®ç«¯å£ '{port.DisplayName}' æœªè¿æ¥"
                        });
                    }
                }
            }
        }
        
        return new IssueReport(issues);
    }
}
```

### 6.4 ç«¯å£æ¸²æŸ“

**è§†è§‰åŒºåˆ†**ï¼ˆâœ… å·²å®ç°ï¼‰ï¼š
- **Control ç«¯å£**ï¼šç™½è‰²åœ†å½¢ (#FFFFFF)ï¼Œçº¿æ¡ç™½è‰²
- **Event ç«¯å£**ï¼šæ©™è‰²åœ†å½¢ (#FF9933)ï¼Œçº¿æ¡æ©™è‰²
- **Data ç«¯å£**ï¼šè“è‰²åœ†å½¢ (#6BB5FF)ï¼Œçº¿æ¡è“è‰²

**è¿çº¿é«˜äº®**ï¼ˆâœ… å·²å®ç°ï¼‰ï¼š
- æ‹–çº¿æ—¶ï¼Œå…¼å®¹ç«¯å£æ˜¾ç¤º**ç»¿è‰²è„‰å†²åŠ¨ç”»**ï¼ˆå‘¼å¸æ•ˆæœï¼‰
- ä¸å…¼å®¹ç«¯å£ä¿æŒåŸè‰²ï¼Œä¸é«˜äº®

**é¼ æ ‡æ‚¬åœæç¤º**ï¼ˆâœ… å·²å®ç°ï¼‰ï¼š
```
æ§åˆ¶æµ (Control) - è¾“å…¥ (Input)
ç±»å‹: exec

æ•°æ® (Data) - è¾“å‡º (Output)
ç±»å‹: Vector3[]
```

**å®ç°ä»£ç **ï¼ˆå‚è€ƒï¼‰ï¼š
```csharp
// BaseFrameBuilder.cs - åˆ¤æ–­å…¼å®¹æ€§
var dragHandler = viewModel.GetHandler<ConnectionDragHandler>();
var dragSourcePort = dragHandler?.DragSourcePort;

if (dragSourcePort != null && port.Id != dragSourcePort.Id)
{
    var policy = viewModel.Graph.Settings.ConnectionPolicy;
    var result = policy.CanConnect(viewModel.Graph, dragSourcePort, port);
    canConnect = result == ConnectionResult.Success;
}

// UnityGraphRenderer.cs - æ¸²æŸ“è„‰å†²å…‰æ•ˆ
if (port.CanConnectToDragSource)
    DrawPortCompatibleGlow(wCenter, theme); // ç»¿è‰²è„‰å†²åŠ¨ç”»
```

### 6.5 Scene é¢„è§ˆåˆ·æ–°æœºåˆ¶ï¼ˆLocation.RandomAreaï¼‰

ä¸ºä¿è¯æ•°æ®æµèŠ‚ç‚¹åœ¨ Scene ä¸­çš„ç»¿è‰²é¢„è§ˆâ€œå‡†ä¸”å¿«â€ï¼Œå½“å‰ç¼–è¾‘å™¨å®ç°å·²ä»è½®è¯¢åˆ‡åˆ°äº‹ä»¶é©±åŠ¨ï¼š

1. **äº‹ä»¶é©±åŠ¨è„æ ‡è®°**ï¼šèŠ‚ç‚¹å±æ€§å˜æ›´ã€Marker å±æ€§å˜æ›´ã€èŠ‚ç‚¹å¢åˆ ç­‰äº‹ä»¶åªå…¥è„é˜Ÿåˆ—ã€‚  
2. **æ‰¹æ¬¡åˆå¹¶åˆ·æ–°**ï¼šé€šè¿‡ `delayCall` åˆå¹¶åŒå¸§å¤šæ¬¡å˜åŒ–ï¼Œç»Ÿä¸€æ‰§è¡Œ `FlushDirtyPreviews`ã€‚  
3. **Markerâ†’Node åå‘ç´¢å¼•**ï¼šæŒ‰ `markerId` å¿«é€Ÿå‘½ä¸­å…³è” `Location.RandomArea` èŠ‚ç‚¹ï¼Œå‡å°‘å…¨å›¾æ‰«æã€‚  
4. **èŠ‚ç‚¹ç­¾åçŸ­è·¯**ï¼šè‹¥èŠ‚ç‚¹å‚æ•° + Marker å‡ ä½•ç­¾åæœªå˜åŒ–ï¼Œè·³è¿‡é‡å¤ `GenerateLocationPreview`ã€‚  
5. **ä¸€è‡´æ€§å…œåº•**ï¼šç´¢å¼•ç©ºå‘½ä¸­å¯é‡å»ºï¼Œåˆ é™¤èŠ‚ç‚¹ä¼šæ¸…ç† preview/signature ç¼“å­˜ï¼Œé¿å… stale æ•°æ®ã€‚

---

## ä¸ƒã€æ•°æ®ç»“æ„è®¾è®¡

### 7.1 ç«¯å£å®šä¹‰

```csharp
[Serializable]
public class PortDefinition
{
    public string Id;
    public string DisplayName;
    public PortKind Kind;
    public PortDirection Direction;
    
    // Data ç«¯å£ä¸“ç”¨
    public string DataType;
    public bool Required;
    public string Description;
}
```

### 7.2 è¾¹ï¼ˆè¿çº¿ï¼‰å®šä¹‰

```csharp
[Serializable]
public class EdgeData
{
    public string SourceNodeId;
    public string SourcePortId;
    public string TargetNodeId;
    public string TargetPortId;
    
    // å…ƒæ•°æ®ï¼ˆç”¨äºéªŒè¯å’Œæ¸²æŸ“ï¼‰
    public PortKind Kind;           // è¿çº¿ç±»å‹
    public string DataType;         // Data è¿çº¿çš„æ•°æ®ç±»å‹
}
```

### 7.3 èŠ‚ç‚¹å®šä¹‰æ‰©å±•

```csharp
public class ActionDefinition
{
    // ç°æœ‰å­—æ®µ...
    public string TypeId;
    public string DisplayName;
    public string Category;
    public PortDefinition[] Ports;  // âœ… æ›¿æ¢ç°æœ‰çš„ Ports æ•°ç»„
    public PropertyDefinition[] Properties;
    // ...
}
```

---

## å…«ã€å®æ–½è·¯çº¿

### Phase 1ï¼šæ ¸å¿ƒæ‰©å±•ï¼ˆ3 å¤©ï¼‰âœ… **å·²å®Œæˆ**

**ç›®æ ‡**ï¼šæ”¯æŒ Data ç«¯å£å’Œè¿çº¿éªŒè¯

- [x] æ‰©å±• `PortDefinition` å¢åŠ  `DataType`ã€`Required` å­—æ®µ
- [x] æ‰©å±• `EdgeData` å¢åŠ  `Kind`ã€`DataType` å­—æ®µ  
- [x] å®ç° `ConnectionValidator` å¼ºåˆ¶ç±»å‹æ£€æŸ¥
- [x] æ›´æ–°ç¼–è¾‘å™¨è¿çº¿é€»è¾‘ï¼Œé›†æˆéªŒè¯å™¨
- [x] å®ç°ç«¯å£é«˜äº®å’Œé”™è¯¯æç¤º UI

**å®æ–½æ—¥æœŸ**ï¼š2026-02-16  
**å®é™…è€—æ—¶**ï¼š1 å¤©

### Phase 2ï¼šèŠ‚ç‚¹é‡æ„ï¼ˆ2 å¤©ï¼‰âœ… **å·²å®Œæˆ**

**ç›®æ ‡**ï¼šå®ç°å…¸å‹æ•°æ®æµèŠ‚ç‚¹

- [x] å®ç° `Location.RandomArea`ï¼ˆProvider èŠ‚ç‚¹ï¼Œè¾“å‡º Vector3[] ä½ç½®åˆ—è¡¨ï¼‰
- [x] å®ç° `Monster.Pool`ï¼ˆProvider èŠ‚ç‚¹ï¼Œè¾“å‡º MonsterConfig[] é…ç½®ï¼‰
- [x] æ”¹é€  `Spawn.Execute`ï¼ˆExecutor èŠ‚ç‚¹ï¼ŒData è¾“å…¥ + Flow æ§åˆ¶ï¼‰
- [x] å®ç° `Condition.AllDead`ï¼ˆCondition èŠ‚ç‚¹ï¼Œç›‘å¬å®ä½“æ­»äº¡ï¼‰

**å®æ–½æ—¥æœŸ**ï¼š2026-02-16  
**å®é™…è€—æ—¶**ï¼š1 å¤©

### Phase 3ï¼šç¼–è¾‘å™¨ä¼˜åŒ–ï¼ˆ2 å¤©ï¼‰âœ… **å·²å®Œæˆ**

**ç›®æ ‡**ï¼šæå‡ç”¨æˆ·ä½“éªŒ

- [x] ç«¯å£è§†è§‰åŒºåˆ†ï¼ˆControl ç™½è‰²ã€Event æ©™è‰²ã€Data è“è‰²ï¼‰
- [x] è¿çº¿é¢œè‰²åŒºåˆ†ï¼ˆè¿çº¿è·Ÿéšæºç«¯å£é¢œè‰²ï¼‰
- [x] æ‹–çº¿æ—¶é«˜äº®å…¼å®¹ç«¯å£ï¼ˆç»¿è‰²è„‰å†²åŠ¨ç”»ï¼‰
- [x] é¼ æ ‡æ‚¬åœæ˜¾ç¤ºç«¯å£ç±»å‹ä¿¡æ¯ï¼ˆKind + Direction + DataTypeï¼‰
- [x] èœå•æ•´åˆå’Œä¸­è‹±æ–‡åŒè¯­åŒ–

**å®æ–½æ—¥æœŸ**ï¼š2026-02-16  
**å®é™…è€—æ—¶**ï¼š0.5 å¤©

**é¢å¤–å®Œæˆ**ï¼š
- [x] ä¿®å¤æ‰€æœ‰èŠ‚ç‚¹ç«¯å£å®šä¹‰é—®é¢˜ï¼ˆFlow.Startã€Trigger.EnterAreaã€Spawn.Waveã€Flow.Joinï¼‰
- [x] ç»Ÿä¸€ Control è¾“å‡ºç«¯å£ä¸º Multiple å®¹é‡ï¼ˆæ”¯æŒå¹¶è¡Œè§¦å‘ï¼‰

### Phase 4ï¼šæµ‹è¯•éªŒè¯ï¼ˆ1 å¤©ï¼‰â³ **å¾…éªŒè¯**

**ç›®æ ‡**ï¼šéªŒè¯è®¾è®¡å¯è¡Œæ€§

- [ ] æ„å»ºå…¸å‹åˆ·æ€ªåœºæ™¯è“å›¾
- [ ] éªŒè¯è¿çº¿è§„åˆ™æ­£ç¡®æ€§
- [ ] å‹åŠ›æµ‹è¯•ï¼ˆå¤æ‚å›¾ï¼‰

**æ€»è®¡ï¼šé¢„è®¡ 8 å¤© â†’ å®é™… 2.5 å¤©**

### Phase 5ï¼šé¢„è§ˆåˆ·æ–°æ€§èƒ½ä¼˜åŒ–ï¼ˆ1 å¤©ï¼‰âœ… **å·²å®Œæˆ**

**ç›®æ ‡**ï¼šæå‡ `Location.RandomArea` Scene é¢„è§ˆåœ¨å¤æ‚ç¼–è¾‘åœºæ™¯ä¸‹çš„æ€§èƒ½ä¸ä¸€è‡´æ€§

- [x] è½®è¯¢åˆ·æ–°æ”¹ä¸ºäº‹ä»¶é©±åŠ¨è„åˆ·æ–°ï¼ˆèŠ‚ç‚¹/å…¨é‡åŒè½¨ï¼‰
- [x] æŒ‰ MarkerId ç²¾å‡†å®šä½èŠ‚ç‚¹åˆ·æ–°ï¼Œæ¥å…¥ Marker å±æ€§å˜æ›´äº‹ä»¶
- [x] å¼•å…¥ `markerId -> nodeIds` åå‘ç´¢å¼•ï¼Œå‡å°‘å…¨å›¾æ‰«æ
- [x] å¼•å…¥èŠ‚ç‚¹ç­¾åçŸ­è·¯ï¼Œç­¾åæœªå˜åŒ–æ—¶è·³è¿‡é‡å¤ç”Ÿæˆ
- [x] æ‰¹é‡ç§»é™¤é¢„è§ˆå¹¶åˆå¹¶é‡ç»˜ï¼Œé™ä½ SceneView é‡ç»˜é¢‘ç‡

---

## ä¹ã€è®¾è®¡å†³ç­–è®°å½•

### 9.1 ä¸ºä»€ä¹ˆå¼ºåˆ¶ç±»å‹æ£€æŸ¥ï¼Ÿ

**å†³ç­–**ï¼šä¸å…¼å®¹çš„è¿çº¿å¿…é¡»é˜»æ­¢

**ç†ç”±**ï¼š
- SceneBlueprint æ˜¯ç­–åˆ’å·¥å…·ï¼Œéœ€è¦å°½æ—©å‘ç°é”™è¯¯
- è¿è¡Œæ—¶æ‰å‘ç°ç±»å‹é”™è¯¯ä¼šä¸¥é‡å½±å“è¿­ä»£æ•ˆç‡
- ç¼–è¾‘å™¨å¯ä»¥æä¾›æ›´å¥½çš„æç¤ºå’Œæ–‡æ¡£

### 9.2 ä¸ºä»€ä¹ˆä¸æ”¯æŒç±»å‹è‡ªåŠ¨è½¬æ¢ï¼Ÿ

**å†³ç­–**ï¼šä¸æ”¯æŒ `Vector3 â†’ Vector3[]` ç­‰è‡ªåŠ¨åŒ…è£…

**ç†ç”±**ï¼š
- ä¿æŒç±»å‹ç³»ç»Ÿç®€å•
- é¿å…éšå¼è¡Œä¸ºå¸¦æ¥çš„å›°æƒ‘
- ç­–åˆ’åº”è¯¥æ˜ç¡®æ•°æ®æµå‘

**æœªæ¥æ‰©å±•**ï¼š
- å¯ä»¥è€ƒè™‘æ˜¾å¼çš„"è½¬æ¢èŠ‚ç‚¹"ï¼ˆå¦‚ `Converter.ToArray`ï¼‰

### 9.3 ä¸ºä»€ä¹ˆåŒºåˆ† Flow å’Œ Eventï¼Ÿ

**å†³ç­–**ï¼šFlow æ˜¯åŒæ­¥æµï¼ŒEvent æ˜¯å¼‚æ­¥è§¦å‘

**ç†ç”±**ï¼š
- Flow è¡¨è¾¾æ˜ç¡®çš„æ‰§è¡Œé¡ºåº
- Event è¡¨è¾¾è¿è¡Œæ—¶åŠ¨æ€è§¦å‘ï¼ˆå¦‚"å…¨éƒ¨æ­»äº¡"ï¼‰
- è§†è§‰ä¸ŠåŒºåˆ†æœ‰åŠ©äºç†è§£è“å›¾è¯­ä¹‰

### 9.4 ä¸ºä»€ä¹ˆ Provider èŠ‚ç‚¹æ—  Flow è¾“å…¥ï¼Ÿ

**å†³ç­–**ï¼šé…ç½®èŠ‚ç‚¹ä¸éœ€è¦è§¦å‘

**ç†ç”±**ï¼š
- å®ƒä»¬åªæä¾›é™æ€é…ç½®ï¼Œä¸æ˜¯"æ‰§è¡Œ"
- ç®€åŒ–è“å›¾ï¼ˆå°‘ä¸€æ¡è¿çº¿ï¼‰
- æœªæ¥å¯ä»¥è€ƒè™‘"æƒ°æ€§æ±‚å€¼"ä¼˜åŒ–

---

## åã€å¾…è®¨è®ºé—®é¢˜

### 10.1 é…ç½®èŠ‚ç‚¹çš„å¯¼å‡ºç­–ç•¥

**é—®é¢˜**ï¼š`Location.RandomArea` ç­‰èŠ‚ç‚¹åœ¨å¯¼å‡ºæ—¶å¦‚ä½•å¤„ç†ï¼Ÿ

**é€‰é¡¹ A**ï¼šå¯¼å‡ºæ—¶å†…è”åˆ°ä½¿ç”¨å®ƒçš„èŠ‚ç‚¹
```json
{
  "type": "Spawn.Execute",
  "config": {
    "positions": { "strategy": "RandomArea", "area": "..." }
  }
}
```

**é€‰é¡¹ B**ï¼šä¿ç•™ç‹¬ç«‹èŠ‚ç‚¹ï¼Œè¿è¡Œæ—¶è§£æ
```json
{
  "nodes": [
    { "id": "loc1", "type": "Location.RandomArea", ... },
    { "id": "spawn1", "type": "Spawn.Execute", ... }
  ],
  "edges": [
    { "from": "loc1.positions", "to": "spawn1.positions" }
  ]
}
```

**å€¾å‘**ï¼šå¾…ç¡®å®šï¼ˆéœ€è¦ç»“åˆè¿è¡Œæ—¶è®¾è®¡å†³ç­–ï¼‰

---

### 10.2 æ˜¯å¦éœ€è¦æ³›å‹æ”¯æŒï¼Ÿ

**é—®é¢˜**ï¼šæ˜¯å¦éœ€è¦ `Array<T>` è¿™æ ·çš„æ³›å‹ç±»å‹ï¼Ÿ

**å½“å‰æ–¹æ¡ˆ**ï¼šé¢„å®šä¹‰å…·ä½“ç±»å‹ï¼ˆå¦‚ `Vector3[]`ã€`EntityRef[]`ï¼‰

**ä¼˜ç‚¹**ï¼šç®€å•ï¼Œç±»å‹æ£€æŸ¥ç›´æ¥
**ç¼ºç‚¹**ï¼šæ¯ç§æ•°ç»„ç±»å‹éƒ½è¦é¢„å®šä¹‰

**æœªæ¥æ‰©å±•**ï¼šå¯ä»¥è€ƒè™‘æ³›å‹ï¼Œä½†å¢åŠ å¤æ‚åº¦

---

### 10.3 å¾ªç¯å¼•ç”¨æ£€æµ‹

**é—®é¢˜**ï¼šæ•°æ®ç«¯å£æ˜¯å¦ä¼šäº§ç”Ÿå¾ªç¯ä¾èµ–ï¼Ÿ

**ç¤ºä¾‹**ï¼š
```
[NodeA] â”€dataâ†’ [NodeB] â”€dataâ†’ [NodeA]  âŒ å¾ªç¯
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ‹“æ‰‘æ’åºæ£€æµ‹
- è¿çº¿æ—¶å®æ—¶æ£€æµ‹å¹¶é˜»æ­¢

**ä¼˜å…ˆçº§**ï¼šä¸­ï¼ˆPhase 3 å®ç°ï¼‰

---

## åä¸€ã€å‚è€ƒèµ„æ–™

### 11.1 ä¸šç•Œæ¡ˆä¾‹

- **Unreal Blueprint**ï¼šFlow + Data åŒå‘æµ
- **Unity Visual Scripting**ï¼šå¼ºç±»å‹ç³»ç»Ÿ
- **Houdini**ï¼šèŠ‚ç‚¹ç»„åˆç”Ÿæˆå‡ ä½•ä½“
- **Shader Graph**ï¼šæ•°æ®æµä¸ºä¸»

### 11.2 ç›¸å…³æ–‡æ¡£

- **`SceneBlueprintæ ¸å¿ƒè®¾è®¡åŸåˆ™.md`**ï¼šğŸ”´ å¿…è¯» - åœºæ™¯ä¸­å¿ƒåŒ–ã€èŒè´£åˆ†ç¦»ã€å•å‘æ•°æ®æµæ ¸å¿ƒç†å¿µ
- `ä¸»çº¿é€Ÿè§ˆ.md`ï¼šSceneBlueprint æ•´ä½“æ¶æ„
- `Playbookæ¦‚å¿µä¸ç¤ºä¾‹.md`ï¼šè¿è¡Œæ—¶æ•°æ®æ ¼å¼
- `SceneMarkerç³»ç»Ÿè®¾è®¡.md`ï¼šåœºæ™¯æ ‡è®°ç»‘å®š

---

**æ–‡æ¡£ç‰ˆæœ¬å†å²**ï¼š
- v1.1 (2026-02-17): è¡¥å…… DataTypeRegistry ç»Ÿä¸€ç±»å‹å…¼å®¹è¯´æ˜ï¼›æ–°å¢ Scene é¢„è§ˆè„åˆ·æ–°ä¼˜åŒ–ï¼ˆmarker ç´¢å¼• + èŠ‚ç‚¹ç­¾åçŸ­è·¯ï¼‰ï¼›æ–°å¢ Phase 5 è®°å½•
- v0.1 (2026-02-16 ä¸Šåˆ): åˆç¨¿ï¼Œå®šä¹‰æ ¸å¿ƒæ¦‚å¿µå’Œè®¾è®¡æ–¹å‘
- v1.0 (2026-02-16 ä¸‹åˆ): Phase 1-3 å®æ–½å®Œæˆ
  - âœ… æ ¸å¿ƒç«¯å£ç³»ç»Ÿæ‰©å±•ï¼ˆData/Event/Control ä¸‰ç§ç±»å‹ï¼‰
  - âœ… è¿çº¿éªŒè¯å™¨å®ç°ï¼ˆç±»å‹æ£€æŸ¥ã€æ–¹å‘æ£€æŸ¥ã€å®¹é‡æ£€æŸ¥ï¼‰
  - âœ… 4 ä¸ªå…¸å‹æ•°æ®æµèŠ‚ç‚¹å®ç°ï¼ˆLocation/Monster/Spawn/Conditionï¼‰
  - âœ… UI å¢å¼ºï¼ˆç«¯å£é¢œè‰²ã€è¿çº¿é¢œè‰²ã€æ‹–çº¿é«˜äº®ã€æ‚¬åœæç¤ºï¼‰
  - âœ… ä¿®å¤æ‰€æœ‰èŠ‚ç‚¹ç«¯å£å®šä¹‰ï¼Œç»Ÿä¸€å¹¶è¡Œè§¦å‘è®¾è®¡
